<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Lai Meihao">
<meta name="dcterms.date" content="2025-03-31">

<title>Health Trend Analysis â€“ Blue PulseðŸ’§</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="../site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">

<script src="../site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>

<script src="../site_libs/plotly-binding-4.10.4/plotly.js"></script>

<script src="../site_libs/typedarray-0.1/typedarray.min.js"></script>

<script src="../site_libs/jquery-3.5.1/jquery.min.js"></script>

<link href="../site_libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">

<script src="../site_libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>

<link href="../site_libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">

<script src="../site_libs/plotly-main-2.11.1/plotly-latest.min.js"></script>



<link rel="stylesheet" href="../styles.css">
<link rel="stylesheet" href="../box.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Blue PulseðŸ’§</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Overview</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-prototype" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Prototype</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-prototype">    
        <li>
    <a class="dropdown-item" href="../Prototype/EDA.html">
 <span class="dropdown-text">Exploratory Data Analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Prototype/PML.html">
 <span class="dropdown-text">Panel Data Modeling</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Prototype/CDA.html">
 <span class="dropdown-text">Comfirmatory Data Analysis(CDA)</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-shiny-app" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Shiny App</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-shiny-app">    
        <li>
    <a class="dropdown-item" href="https://linxy-xinyue.shinyapps.io/Water_Pulse/">
 <span class="dropdown-text">Shiny App</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../data/UserGuide.pdf">
 <span class="dropdown-text">User guide</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../Poster.pdf"> 
<span class="menu-text">Project Poster</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-team" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Team</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-team">    
        <li>
    <a class="dropdown-item" href="../about.html">
 <span class="dropdown-text">About this project</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../MeetingMinutes.html">
 <span class="dropdown-text">Meeting Minutes</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Proposal.html">
 <span class="dropdown-text">Proposal</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">1. Overview</a></li>
  <li><a href="#initial-data-preparation" id="toc-initial-data-preparation" class="nav-link" data-scroll-target="#initial-data-preparation">2. Initial Data Preparation</a>
  <ul class="collapse">
  <li><a href="#install-and-launch-r-packages" id="toc-install-and-launch-r-packages" class="nav-link" data-scroll-target="#install-and-launch-r-packages">2.1 Install and launch R packages</a></li>
  <li><a href="#import-data" id="toc-import-data" class="nav-link" data-scroll-target="#import-data">2.2 Import Data</a></li>
  <li><a href="#overview-of-the-data" id="toc-overview-of-the-data" class="nav-link" data-scroll-target="#overview-of-the-data"><strong>2.3 Overview of the data</strong></a>
  <ul class="collapse">
  <li><a href="#dataset-structure" id="toc-dataset-structure" class="nav-link" data-scroll-target="#dataset-structure"><strong>Dataset Structure</strong></a></li>
  </ul></li>
  </ul></li>
  <li><a href="#data-processing" id="toc-data-processing" class="nav-link" data-scroll-target="#data-processing">3. Data Processing</a>
  <ul class="collapse">
  <li><a href="#missing-data" id="toc-missing-data" class="nav-link" data-scroll-target="#missing-data">3.1 Missing Data</a></li>
  <li><a href="#duplicate-value" id="toc-duplicate-value" class="nav-link" data-scroll-target="#duplicate-value">3.2 Duplicate Value</a></li>
  </ul></li>
  <li><a href="#plm-linear-model-for-panel-data" id="toc-plm-linear-model-for-panel-data" class="nav-link" data-scroll-target="#plm-linear-model-for-panel-data">4. PLM: Linear Model for panel data</a>
  <ul class="collapse">
  <li><a href="#overview-of-plm" id="toc-overview-of-plm" class="nav-link" data-scroll-target="#overview-of-plm">4.1 Overview of plm</a></li>
  <li><a href="#creating-panel-data" id="toc-creating-panel-data" class="nav-link" data-scroll-target="#creating-panel-data">4.2 Creating Panel Data</a></li>
  <li><a href="#plm-for-coefficient-of-the-wash-variables" id="toc-plm-for-coefficient-of-the-wash-variables" class="nav-link" data-scroll-target="#plm-for-coefficient-of-the-wash-variables">4.3 PLM for coefficient of the WASH Variables</a></li>
  <li><a href="#coefficient-list" id="toc-coefficient-list" class="nav-link" data-scroll-target="#coefficient-list">4.4 Coefficient list</a></li>
  </ul></li>
  <li><a href="#time-series-analysis-for-period-2022-to-2030-for-wash-indicators" id="toc-time-series-analysis-for-period-2022-to-2030-for-wash-indicators" class="nav-link" data-scroll-target="#time-series-analysis-for-period-2022-to-2030-for-wash-indicators">5. Time Series Analysis for period 2022 to 2030 for wash indicators</a>
  <ul class="collapse">
  <li><a href="#create-selected_data" id="toc-create-selected_data" class="nav-link" data-scroll-target="#create-selected_data">5.1 Create <code>selected_data</code></a>
  <ul class="collapse">
  <li><a href="#converting-data-type" id="toc-converting-data-type" class="nav-link" data-scroll-target="#converting-data-type">5.2 Converting Data type</a></li>
  <li><a href="#times-series-analysis-using-arima" id="toc-times-series-analysis-using-arima" class="nav-link" data-scroll-target="#times-series-analysis-using-arima">5.3 Times Series Analysis using ARIMA</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#forecast-for-health-indicator" id="toc-forecast-for-health-indicator" class="nav-link" data-scroll-target="#forecast-for-health-indicator">6. Forecast for health indicator</a>
  <ul class="collapse">
  <li><a href="#apply-coefficient-to-forecast-data" id="toc-apply-coefficient-to-forecast-data" class="nav-link" data-scroll-target="#apply-coefficient-to-forecast-data">6.1 Apply coefficient to forecast data</a></li>
  </ul></li>
  <li><a href="#merging-historical-data-with-forcasted-data" id="toc-merging-historical-data-with-forcasted-data" class="nav-link" data-scroll-target="#merging-historical-data-with-forcasted-data">7. Merging Historical data with Forcasted data</a></li>
  <li><a href="#visualize-test-result" id="toc-visualize-test-result" class="nav-link" data-scroll-target="#visualize-test-result">8. Visualize test result</a>
  <ul class="collapse">
  <li><a href="#importing-the-combined-data" id="toc-importing-the-combined-data" class="nav-link" data-scroll-target="#importing-the-combined-data">8.1 Importing the combined data</a></li>
  <li><a href="#plotting-for-visualization" id="toc-plotting-for-visualization" class="nav-link" data-scroll-target="#plotting-for-visualization">8.2 plotting for visualization</a></li>
  <li><a href="#interactive-plot-using-plotly" id="toc-interactive-plot-using-plotly" class="nav-link" data-scroll-target="#interactive-plot-using-plotly">8.3 Interactive plot using plotly</a>
  <ul class="collapse">
  <li><a href="#import-data-1" id="toc-import-data-1" class="nav-link" data-scroll-target="#import-data-1">8.3.1 Import Data</a></li>
  <li><a href="#visualizing-the-change-over-time-through-interactive-plot" id="toc-visualizing-the-change-over-time-through-interactive-plot" class="nav-link" data-scroll-target="#visualizing-the-change-over-time-through-interactive-plot">8.3.2 Visualizing the change over time through interactive plot</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Health Trend Analysis</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Lai Meihao </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 31, 2025</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">April 6, 2025</p>
    </div>
  </div>
    
  </div>
  


</header>


<section id="overview" class="level1">
<h1>1. Overview</h1>
<p>In this analysis, I will explore the forecasting of health outcomes related to WASH (Water, Sanitation, and Hygiene) indicators using <strong>Panel Linear Models (PLM)</strong> and <strong>Time-series analysis (ARIMA</strong>). The goal is to project future trends in diseases such as Diarrhea, Typhoid, and Hepatitis across different WHO regions, based on the impact of WASH-related factors like water access, sanitation, and hygiene practices.</p>
</section>
<section id="initial-data-preparation" class="level1">
<h1>2. Initial Data Preparation</h1>
<section id="install-and-launch-r-packages" class="level2">
<h2 class="anchored" data-anchor-id="install-and-launch-r-packages">2.1 Install and launch R packages</h2>
<p>The project uses <code>p_load()</code> of pacman package to check if the R package are installed in the computer.</p>
<p>The following code chunk is used to install and launch the R packages.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse, ggplot2, plm,ExPanDaR,lubridate, ggthemes, plotly,dplyr,purrr,forecast)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="import-data" class="level2">
<h2 class="anchored" data-anchor-id="import-data">2.2 Import Data</h2>
<p>The below code chunk use <code>read_csv()</code> to read the csv file into R as a data frame</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>merged_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/merged_data.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="overview-of-the-data" class="level2">
<h2 class="anchored" data-anchor-id="overview-of-the-data"><strong>2.3 Overview of the data</strong></h2>
<section id="dataset-structure" class="level3">
<h3 class="anchored" data-anchor-id="dataset-structure"><strong>Dataset Structure</strong></h3>
<p>The below code chunk check the structure of the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(merged_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1,232
Columns: 8
$ Region        &lt;chr&gt; "Region of the Americas", "Region of the Americas", "Regâ€¦
$ Year          &lt;dbl&gt; 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 20â€¦
$ TyphoidRate   &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,â€¦
$ DiarrheaRate  &lt;dbl&gt; 5.88, 5.88, 5.88, 5.88, 5.88, 5.88, 5.88, 5.88, 5.88, 5.â€¦
$ HepatitisRate &lt;dbl&gt; 0.38, 0.38, 0.38, 0.38, 0.38, 0.38, 0.38, 0.38, 0.38, 0.â€¦
$ UnsafeRisk    &lt;dbl&gt; 1.00, 1.00, 1.00, 1.00, 1.00, 1.00, 1.00, 1.00, 1.00, 0.â€¦
$ Series.Name   &lt;chr&gt; "Level of water stress: freshwater withdrawal as a propoâ€¦
$ AvgValue      &lt;dbl&gt; 1.308801e+01, 8.252346e+00, 8.867545e+01, 7.710693e+01, â€¦</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(merged_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 Ã— 8
  Region      Year TyphoidRate DiarrheaRate HepatitisRate UnsafeRisk Series.Name
  &lt;chr&gt;      &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;         &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;      
1 Region ofâ€¦  2000           0         5.88          0.38          1 Level of wâ€¦
2 Region ofâ€¦  2000           0         5.88          0.38          1 People praâ€¦
3 Region ofâ€¦  2000           0         5.88          0.38          1 People usiâ€¦
4 Region ofâ€¦  2000           0         5.88          0.38          1 People usiâ€¦
5 Region ofâ€¦  2000           0         5.88          0.38          1 People usiâ€¦
6 Region ofâ€¦  2000           0         5.88          0.38          1 People usiâ€¦
# â„¹ 1 more variable: AvgValue &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="data-processing" class="level1">
<h1>3. Data Processing</h1>
<section id="missing-data" class="level2">
<h2 class="anchored" data-anchor-id="missing-data">3.1 Missing Data</h2>
<p>The below code chunk of <code>is.na()</code> to check the missing values in the <code>merged_data</code> frame, and returns a logical matrix( or vector, depending on the data structure. <code>sum()</code> function calculate the sum of the elements of the logical matrix or vector.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(merged_data))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
<p>The result of zero indicate that there no missing in the merge dataset.</p>
</section>
<section id="duplicate-value" class="level2">
<h2 class="anchored" data-anchor-id="duplicate-value">3.2 Duplicate Value</h2>
<p>The <code>duplicated()</code> function checks for duplicate rows in the <code>merged_data</code> frame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">duplicated</span>(merged_data))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
<p>The result indicate that there is no duplicate in the <code>merged_data</code>.</p>
</section>
</section>
<section id="plm-linear-model-for-panel-data" class="level1">
<h1>4. PLM: Linear Model for panel data</h1>
<section id="overview-of-plm" class="level2">
<h2 class="anchored" data-anchor-id="overview-of-plm">4.1 Overview of plm</h2>
<p>A <strong>Panel Linear Model (PLM)</strong> is a statistical model used to analyze data that includes observations over time (time-series) and across different units (cross-sectional). This type of data, often called panel data or longitudinal data, involves multiple subjects (such as countries, individuals, or companies) observed over several time periods.</p>
<p>For this project, we are using data from the World Development Indicators (WDI) as WASH (Water, Sanitation, and Hygiene) indicators and data from the Institute for Health Metrics as health indicators. We will apply the PLM to estimate the coefficients of the WASH indicators for each health indicator. Subsequently, we will use time-series analysis to forecast trends for the health indicators, particularly disease rates, based on the coefficients obtained from the WASH indicators.</p>
<p>To apply PLM in our project, we will be using <a href="https://cran.r-project.org/web/packages/plm/plm.pdf"><code>plm</code></a> package in R.</p>
</section>
<section id="creating-panel-data" class="level2">
<h2 class="anchored" data-anchor-id="creating-panel-data">4.2 Creating Panel Data</h2>
<p>Before proceed to the PLM analysis, we will first create panel data. We will be start by understanding <code>merged_data</code>.<br>
The below code chunk use <code>names()</code> function to extract the names of the columns in the <code>merged_data</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(merged_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Region"        "Year"          "TyphoidRate"   "DiarrheaRate" 
[5] "HepatitisRate" "UnsafeRisk"    "Series.Name"   "AvgValue"     </code></pre>
</div>
</div>
<p>The output shows the columns in the <code>merged_data</code>.</p>
<p>The below code chunk use the <code>summary()</code> function to provide a quick overview of each column in a dataframe.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(merged_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Region               Year       TyphoidRate       DiarrheaRate  
 Length:1232        Min.   :2000   Min.   :0.00000   Min.   : 2.72  
 Class :character   1st Qu.:2005   1st Qu.:0.00000   1st Qu.: 5.27  
 Mode  :character   Median :2010   Median :0.01500   Median : 8.80  
                    Mean   :2010   Mean   :0.03614   Mean   :12.05  
                    3rd Qu.:2016   3rd Qu.:0.04000   3rd Qu.:21.36  
                    Max.   :2021   Max.   :0.22000   Max.   :22.74  
 HepatitisRate      UnsafeRisk     Series.Name           AvgValue        
 Min.   :0.2800   Min.   : 0.080   Length:1232        Min.   :        0  
 1st Qu.:0.3700   1st Qu.: 0.290   Class :character   1st Qu.:       33  
 Median :0.4800   Median : 1.245   Mode  :character   Median :       71  
 Mean   :0.5292   Mean   : 3.470                      Mean   :  5899097  
 3rd Qu.:0.6800   3rd Qu.: 6.607                      3rd Qu.:      104  
 Max.   :0.8300   Max.   :10.680                      Max.   :187658229  </code></pre>
</div>
</div>
<p>This summary provides key insights into the distribution and spread of values in each of the columns. The <code>AvgValue</code> column, for instance, has a wide range, with very large maximum values compared to the median and first quartile. Similarly, health indicators like <code>TyphoidRate</code>, <code>DiarrheaRate</code>, and <code>HepatitisRate</code> show varying levels of distribution, with some regions having very low rates and others experiencing high rates.</p>
<p>The below code chunk use <code>str()</code> function to display the structure of the merged_data. It provides a compact overview of the data type of each column, as well as the first few entries in each column.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(merged_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>spc_tbl_ [1,232 Ã— 8] (S3: spec_tbl_df/tbl_df/tbl/data.frame)
 $ Region       : chr [1:1232] "Region of the Americas" "Region of the Americas" "Region of the Americas" "Region of the Americas" ...
 $ Year         : num [1:1232] 2000 2000 2000 2000 2000 ...
 $ TyphoidRate  : num [1:1232] 0 0 0 0 0 0 0 0 0 0 ...
 $ DiarrheaRate : num [1:1232] 5.88 5.88 5.88 5.88 5.88 5.88 5.88 5.88 5.88 5.81 ...
 $ HepatitisRate: num [1:1232] 0.38 0.38 0.38 0.38 0.38 0.38 0.38 0.38 0.38 0.38 ...
 $ UnsafeRisk   : num [1:1232] 1 1 1 1 1 1 1 1 1 0.94 ...
 $ Series.Name  : chr [1:1232] "Level of water stress: freshwater withdrawal as a proportion of available freshwater resources" "People practicing open defecation (% of population)" "People using at least basic drinking water services (% of population)" "People using at least basic sanitation services (% of population)" ...
 $ AvgValue     : num [1:1232] 13.09 8.25 88.68 77.11 61.49 ...
 - attr(*, "spec")=
  .. cols(
  ..   Region = col_character(),
  ..   Year = col_double(),
  ..   TyphoidRate = col_double(),
  ..   DiarrheaRate = col_double(),
  ..   HepatitisRate = col_double(),
  ..   UnsafeRisk = col_double(),
  ..   Series.Name = col_character(),
  ..   AvgValue = col_double()
  .. )
 - attr(*, "problems")=&lt;externalptr&gt; </code></pre>
</div>
</div>
<p>The dataset is a <strong>spec_tbl_df</strong> (which is a specific type of tibble in R) with <strong>1232 rows and 8 columns</strong>. The dataset includes 8 variables (columns), and it uses the <code>spec_tbl_df</code> class from the <code>tibble</code> package.</p>
<p>The below code chunk summaries the <code>merged_data</code> set by grouping it by <code>Region</code> and <code>Year</code>.</p>
<p>The result of this code is a new data frame, <code>merged_data_clean</code>, where:</p>
<ul>
<li><p>Each row corresponds to a unique combination of <code>Region</code> and <code>Year</code>.</p></li>
<li><p>For each <code>Region</code> and <code>Year</code>, the mean values for <code>TyphoidRate</code>, <code>DiarrheaRate</code>, <code>HepatitisRate</code>, and <code>UnsafeRisk</code> are calculated, ignoring missing values.</p></li>
</ul>
<p>The code chunk below use the <code>pivot_wider()</code> function from the <code>tidyverse</code> package to transform the <code>merged_data</code> dataset from long format to wide format. As the WASH indicator are store in the column <code>Series.Name</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>wide_data <span class="ot">&lt;-</span> merged_data <span class="sc">%&gt;%</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">id_cols =</span> <span class="fu">c</span>(Region, Year, TyphoidRate, DiarrheaRate, HepatitisRate, UnsafeRisk),</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> Series.Name,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> AvgValue</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The code chunk below creates a panel data frame using the <code>pdata.frame()</code> function from the <code>plm</code> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>pdata <span class="ot">&lt;-</span> <span class="fu">pdata.frame</span>(wide_data, <span class="at">index =</span> <span class="fu">c</span>(<span class="st">"Region"</span>, <span class="st">"Year"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The result of this code is that the <code>wide_data</code> data frame is now transformed into a <strong>panel data frame</strong>, stored in the variable <code>pdata</code>. This allows we to perform panel data analysis using the <code>plm</code> package.</p>
<ul>
<li>The <code>pdata</code> object will now be suitable for running panel regressions, such as fixed effects or random effects models, using functions like <code>plm()</code> from the <code>plm</code> package.</li>
</ul>
<p>The below code chunk use <code>colnames()</code> function to return the column names of the <code>pdata</code> which is now a panel data after being converted by <code>pdata.frame()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(pdata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Region"                                                                                          
 [2] "Year"                                                                                            
 [3] "TyphoidRate"                                                                                     
 [4] "DiarrheaRate"                                                                                    
 [5] "HepatitisRate"                                                                                   
 [6] "UnsafeRisk"                                                                                      
 [7] "Level.of.water.stress..freshwater.withdrawal.as.a.proportion.of.available.freshwater.resources"  
 [8] "People.practicing.open.defecation....of.population."                                             
 [9] "People.using.at.least.basic.drinking.water.services....of.population."                           
[10] "People.using.at.least.basic.sanitation.services....of.population."                               
[11] "People.using.safely.managed.drinking.water.services....of.population."                           
[12] "People.using.safely.managed.sanitation.services....of.population."                               
[13] "Population.density..people.per.sq..km.of.land.area."                                             
[14] "Population..total"                                                                               
[15] "Water.productivity..total..constant.2015.US..GDP.per.cubic.meter.of.total.freshwater.withdrawal."
[16] "People.with.basic.handwashing.facilities.including.soap.and.water....of.population."             </code></pre>
</div>
</div>
</section>
<section id="plm-for-coefficient-of-the-wash-variables" class="level2">
<h2 class="anchored" data-anchor-id="plm-for-coefficient-of-the-wash-variables">4.3 PLM for coefficient of the WASH Variables</h2>
<p>The below code chunk fits a Fixed Effects Model also known as the â€˜withinâ€™ model) using the <code>plm</code> function from the <code>plm</code> package in R analyse the relationship between <code>DiarrheaRate</code> and WASH indicators.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">plm</span>(DiarrheaRate <span class="sc">~</span> </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  People.practicing.open.defecation....of.population. <span class="sc">+</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  People.using.at.least.basic.drinking.water.services....of.population. <span class="sc">+</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  People.using.at.least.basic.sanitation.services....of.population. <span class="sc">+</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  Population.density..people.per.sq..km.of.land.area. <span class="sc">+</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  Water.productivity..total..constant.<span class="fl">2015.</span>US..GDP.per.cubic.meter.of.total.freshwater.withdrawal. <span class="sc">+</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  Level.of.water.stress..freshwater.withdrawal.as.a.proportion.of.available.freshwater.resources <span class="sc">+</span>  <span class="co"># Level of water stress</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  People.using.safely.managed.drinking.water.services....of.population. <span class="sc">+</span>  <span class="co"># People using safely managed drinking water services</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  People.using.safely.managed.sanitation.services....of.population.,  <span class="co"># People using safely managed sanitation services</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> pdata,</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> <span class="st">"within"</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Oneway (individual) effect Within Model

Call:
plm(formula = DiarrheaRate ~ People.practicing.open.defecation....of.population. + 
    People.using.at.least.basic.drinking.water.services....of.population. + 
    People.using.at.least.basic.sanitation.services....of.population. + 
    Population.density..people.per.sq..km.of.land.area. + Water.productivity..total..constant.2015.US..GDP.per.cubic.meter.of.total.freshwater.withdrawal. + 
    Level.of.water.stress..freshwater.withdrawal.as.a.proportion.of.available.freshwater.resources + 
    People.using.safely.managed.drinking.water.services....of.population. + 
    People.using.safely.managed.sanitation.services....of.population., 
    data = pdata, model = "within")

Balanced Panel: n = 6, T = 22, N = 132

Residuals:
     Min.   1st Qu.    Median   3rd Qu.      Max. 
-1.021289 -0.248422 -0.060002  0.257269  0.961836 

Coefficients:
                                                                                                   Estimate
People.practicing.open.defecation....of.population.                                              -0.6755407
People.using.at.least.basic.drinking.water.services....of.population.                            -1.0144098
People.using.at.least.basic.sanitation.services....of.population.                                -0.1706479
Population.density..people.per.sq..km.of.land.area.                                               0.0014148
Water.productivity..total..constant.2015.US..GDP.per.cubic.meter.of.total.freshwater.withdrawal.  0.0029523
Level.of.water.stress..freshwater.withdrawal.as.a.proportion.of.available.freshwater.resources    0.0110199
People.using.safely.managed.drinking.water.services....of.population.                             0.2855646
People.using.safely.managed.sanitation.services....of.population.                                -0.1302516
                                                                                                 Std. Error
People.practicing.open.defecation....of.population.                                               0.1085486
People.using.at.least.basic.drinking.water.services....of.population.                             0.1014805
People.using.at.least.basic.sanitation.services....of.population.                                 0.0915876
Population.density..people.per.sq..km.of.land.area.                                               0.0052560
Water.productivity..total..constant.2015.US..GDP.per.cubic.meter.of.total.freshwater.withdrawal.  0.0011407
Level.of.water.stress..freshwater.withdrawal.as.a.proportion.of.available.freshwater.resources    0.0034595
People.using.safely.managed.drinking.water.services....of.population.                             0.1001031
People.using.safely.managed.sanitation.services....of.population.                                 0.1234424
                                                                                                 t-value
People.practicing.open.defecation....of.population.                                              -6.2234
People.using.at.least.basic.drinking.water.services....of.population.                            -9.9961
People.using.at.least.basic.sanitation.services....of.population.                                -1.8632
Population.density..people.per.sq..km.of.land.area.                                               0.2692
Water.productivity..total..constant.2015.US..GDP.per.cubic.meter.of.total.freshwater.withdrawal.  2.5882
Level.of.water.stress..freshwater.withdrawal.as.a.proportion.of.available.freshwater.resources    3.1854
People.using.safely.managed.drinking.water.services....of.population.                             2.8527
People.using.safely.managed.sanitation.services....of.population.                                -1.0552
                                                                                                  Pr(&gt;|t|)
People.practicing.open.defecation....of.population.                                              7.677e-09
People.using.at.least.basic.drinking.water.services....of.population.                            &lt; 2.2e-16
People.using.at.least.basic.sanitation.services....of.population.                                 0.064917
Population.density..people.per.sq..km.of.land.area.                                               0.788259
Water.productivity..total..constant.2015.US..GDP.per.cubic.meter.of.total.freshwater.withdrawal.  0.010860
Level.of.water.stress..freshwater.withdrawal.as.a.proportion.of.available.freshwater.resources    0.001849
People.using.safely.managed.drinking.water.services....of.population.                             0.005120
People.using.safely.managed.sanitation.services....of.population.                                 0.293507
                                                                                                    
People.practicing.open.defecation....of.population.                                              ***
People.using.at.least.basic.drinking.water.services....of.population.                            ***
People.using.at.least.basic.sanitation.services....of.population.                                .  
Population.density..people.per.sq..km.of.land.area.                                                 
Water.productivity..total..constant.2015.US..GDP.per.cubic.meter.of.total.freshwater.withdrawal. *  
Level.of.water.stress..freshwater.withdrawal.as.a.proportion.of.available.freshwater.resources   ** 
People.using.safely.managed.drinking.water.services....of.population.                            ** 
People.using.safely.managed.sanitation.services....of.population.                                   
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Total Sum of Squares:    146.4
Residual Sum of Squares: 21.365
R-Squared:      0.85406
Adj. R-Squared: 0.83798
F-statistic: 86.3196 on 8 and 118 DF, p-value: &lt; 2.22e-16</code></pre>
</div>
</div>
<p>The below code chunk fits a Fixed Effects Model also known as the â€˜withinâ€™ model) using the <code>plm</code> function from the <code>plm</code> package in R analyse the relationship between <code>HeptatitisRate</code> and WASH indicators.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">plm</span>(HepatitisRate <span class="sc">~</span> </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  People.practicing.open.defecation....of.population. <span class="sc">+</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  People.using.at.least.basic.drinking.water.services....of.population. <span class="sc">+</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  People.using.at.least.basic.sanitation.services....of.population. <span class="sc">+</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  Population.density..people.per.sq..km.of.land.area. <span class="sc">+</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  Water.productivity..total..constant.<span class="fl">2015.</span>US..GDP.per.cubic.meter.of.total.freshwater.withdrawal. <span class="sc">+</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  Level.of.water.stress..freshwater.withdrawal.as.a.proportion.of.available.freshwater.resources <span class="sc">+</span>  <span class="co"># Level of water stress</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  People.using.safely.managed.drinking.water.services....of.population. <span class="sc">+</span>  <span class="co"># People using safely managed drinking water services</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  People.using.safely.managed.sanitation.services....of.population.,  <span class="co"># People using safely managed sanitation services</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> pdata,</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> <span class="st">"within"</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Oneway (individual) effect Within Model

Call:
plm(formula = HepatitisRate ~ People.practicing.open.defecation....of.population. + 
    People.using.at.least.basic.drinking.water.services....of.population. + 
    People.using.at.least.basic.sanitation.services....of.population. + 
    Population.density..people.per.sq..km.of.land.area. + Water.productivity..total..constant.2015.US..GDP.per.cubic.meter.of.total.freshwater.withdrawal. + 
    Level.of.water.stress..freshwater.withdrawal.as.a.proportion.of.available.freshwater.resources + 
    People.using.safely.managed.drinking.water.services....of.population. + 
    People.using.safely.managed.sanitation.services....of.population., 
    data = pdata, model = "within")

Balanced Panel: n = 6, T = 22, N = 132

Residuals:
      Min.    1st Qu.     Median    3rd Qu.       Max. 
-0.0677318 -0.0066636  0.0013683  0.0085389  0.0338086 

Coefficients:
                                                                                                    Estimate
People.practicing.open.defecation....of.population.                                               8.5691e-03
People.using.at.least.basic.drinking.water.services....of.population.                             2.3667e-02
People.using.at.least.basic.sanitation.services....of.population.                                -1.1585e-02
Population.density..people.per.sq..km.of.land.area.                                              -3.7942e-04
Water.productivity..total..constant.2015.US..GDP.per.cubic.meter.of.total.freshwater.withdrawal.  8.6247e-05
Level.of.water.stress..freshwater.withdrawal.as.a.proportion.of.available.freshwater.resources   -1.0463e-03
People.using.safely.managed.drinking.water.services....of.population.                            -3.6054e-03
People.using.safely.managed.sanitation.services....of.population.                                -5.7112e-04
                                                                                                  Std. Error
People.practicing.open.defecation....of.population.                                               3.8073e-03
People.using.at.least.basic.drinking.water.services....of.population.                             3.5594e-03
People.using.at.least.basic.sanitation.services....of.population.                                 3.2124e-03
Population.density..people.per.sq..km.of.land.area.                                               1.8435e-04
Water.productivity..total..constant.2015.US..GDP.per.cubic.meter.of.total.freshwater.withdrawal.  4.0009e-05
Level.of.water.stress..freshwater.withdrawal.as.a.proportion.of.available.freshwater.resources    1.2134e-04
People.using.safely.managed.drinking.water.services....of.population.                             3.5111e-03
People.using.safely.managed.sanitation.services....of.population.                                 4.3297e-03
                                                                                                 t-value
People.practicing.open.defecation....of.population.                                               2.2507
People.using.at.least.basic.drinking.water.services....of.population.                             6.6490
People.using.at.least.basic.sanitation.services....of.population.                                -3.6063
Population.density..people.per.sq..km.of.land.area.                                              -2.0581
Water.productivity..total..constant.2015.US..GDP.per.cubic.meter.of.total.freshwater.withdrawal.  2.1557
Level.of.water.stress..freshwater.withdrawal.as.a.proportion.of.available.freshwater.resources   -8.6230
People.using.safely.managed.drinking.water.services....of.population.                            -1.0269
People.using.safely.managed.sanitation.services....of.population.                                -0.1319
                                                                                                  Pr(&gt;|t|)
People.practicing.open.defecation....of.population.                                              0.0262575
People.using.at.least.basic.drinking.water.services....of.population.                            9.653e-10
People.using.at.least.basic.sanitation.services....of.population.                                0.0004564
Population.density..people.per.sq..km.of.land.area.                                              0.0417807
Water.productivity..total..constant.2015.US..GDP.per.cubic.meter.of.total.freshwater.withdrawal. 0.0331398
Level.of.water.stress..freshwater.withdrawal.as.a.proportion.of.available.freshwater.resources   3.505e-14
People.using.safely.managed.drinking.water.services....of.population.                            0.3065854
People.using.safely.managed.sanitation.services....of.population.                                0.8952825
                                                                                                    
People.practicing.open.defecation....of.population.                                              *  
People.using.at.least.basic.drinking.water.services....of.population.                            ***
People.using.at.least.basic.sanitation.services....of.population.                                ***
Population.density..people.per.sq..km.of.land.area.                                              *  
Water.productivity..total..constant.2015.US..GDP.per.cubic.meter.of.total.freshwater.withdrawal. *  
Level.of.water.stress..freshwater.withdrawal.as.a.proportion.of.available.freshwater.resources   ***
People.using.safely.managed.drinking.water.services....of.population.                               
People.using.safely.managed.sanitation.services....of.population.                                   
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Total Sum of Squares:    0.475
Residual Sum of Squares: 0.026284
R-Squared:      0.94467
Adj. R-Squared: 0.93857
F-statistic: 251.814 on 8 and 118 DF, p-value: &lt; 2.22e-16</code></pre>
</div>
</div>
<p>The below code chunk fits a Fixed Effects Model also known as the â€˜withinâ€™ model) using the <code>plm</code> function from the <code>plm</code> package in R analyse the relationship between <code>unsafetyRisk</code> and WASH indicators.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">plm</span>(UnsafeRisk <span class="sc">~</span> </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  People.practicing.open.defecation....of.population. <span class="sc">+</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  People.using.at.least.basic.drinking.water.services....of.population. <span class="sc">+</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  People.using.at.least.basic.sanitation.services....of.population. <span class="sc">+</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  Population.density..people.per.sq..km.of.land.area. <span class="sc">+</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  Water.productivity..total..constant.<span class="fl">2015.</span>US..GDP.per.cubic.meter.of.total.freshwater.withdrawal. <span class="sc">+</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  Level.of.water.stress..freshwater.withdrawal.as.a.proportion.of.available.freshwater.resources <span class="sc">+</span>  <span class="co"># Level of water stress</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  People.using.safely.managed.drinking.water.services....of.population. <span class="sc">+</span>  <span class="co"># People using safely managed drinking water services</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  People.using.safely.managed.sanitation.services....of.population.,  <span class="co"># People using safely managed sanitation services</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> pdata,</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> <span class="st">"within"</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Oneway (individual) effect Within Model

Call:
plm(formula = UnsafeRisk ~ People.practicing.open.defecation....of.population. + 
    People.using.at.least.basic.drinking.water.services....of.population. + 
    People.using.at.least.basic.sanitation.services....of.population. + 
    Population.density..people.per.sq..km.of.land.area. + Water.productivity..total..constant.2015.US..GDP.per.cubic.meter.of.total.freshwater.withdrawal. + 
    Level.of.water.stress..freshwater.withdrawal.as.a.proportion.of.available.freshwater.resources + 
    People.using.safely.managed.drinking.water.services....of.population. + 
    People.using.safely.managed.sanitation.services....of.population., 
    data = pdata, model = "within")

Balanced Panel: n = 6, T = 22, N = 132

Residuals:
     Min.   1st Qu.    Median   3rd Qu.      Max. 
-1.683001 -0.073009  0.020810  0.128213  0.580755 

Coefficients:
                                                                                                    Estimate
People.practicing.open.defecation....of.population.                                               0.72708968
People.using.at.least.basic.drinking.water.services....of.population.                             0.43477443
People.using.at.least.basic.sanitation.services....of.population.                                 0.21651056
Population.density..people.per.sq..km.of.land.area.                                               0.00037018
Water.productivity..total..constant.2015.US..GDP.per.cubic.meter.of.total.freshwater.withdrawal.  0.00063762
Level.of.water.stress..freshwater.withdrawal.as.a.proportion.of.available.freshwater.resources   -0.01913748
People.using.safely.managed.drinking.water.services....of.population.                            -0.25010937
People.using.safely.managed.sanitation.services....of.population.                                 0.04852111
                                                                                                  Std. Error
People.practicing.open.defecation....of.population.                                               0.07488698
People.using.at.least.basic.drinking.water.services....of.population.                             0.07001070
People.using.at.least.basic.sanitation.services....of.population.                                 0.06318565
Population.density..people.per.sq..km.of.land.area.                                               0.00362608
Water.productivity..total..constant.2015.US..GDP.per.cubic.meter.of.total.freshwater.withdrawal.  0.00078695
Level.of.water.stress..freshwater.withdrawal.as.a.proportion.of.available.freshwater.resources    0.00238667
People.using.safely.managed.drinking.water.services....of.population.                             0.06906044
People.using.safely.managed.sanitation.services....of.population.                                 0.08516212
                                                                                                 t-value
People.practicing.open.defecation....of.population.                                               9.7092
People.using.at.least.basic.drinking.water.services....of.population.                             6.2101
People.using.at.least.basic.sanitation.services....of.population.                                 3.4266
Population.density..people.per.sq..km.of.land.area.                                               0.1021
Water.productivity..total..constant.2015.US..GDP.per.cubic.meter.of.total.freshwater.withdrawal.  0.8102
Level.of.water.stress..freshwater.withdrawal.as.a.proportion.of.available.freshwater.resources   -8.0185
People.using.safely.managed.drinking.water.services....of.population.                            -3.6216
People.using.safely.managed.sanitation.services....of.population.                                 0.5697
                                                                                                  Pr(&gt;|t|)
People.practicing.open.defecation....of.population.                                              &lt; 2.2e-16
People.using.at.least.basic.drinking.water.services....of.population.                            8.182e-09
People.using.at.least.basic.sanitation.services....of.population.                                0.0008420
Population.density..people.per.sq..km.of.land.area.                                              0.9188591
Water.productivity..total..constant.2015.US..GDP.per.cubic.meter.of.total.freshwater.withdrawal. 0.4194354
Level.of.water.stress..freshwater.withdrawal.as.a.proportion.of.available.freshwater.resources   8.713e-13
People.using.safely.managed.drinking.water.services....of.population.                            0.0004328
People.using.safely.managed.sanitation.services....of.population.                                0.5699304
                                                                                                    
People.practicing.open.defecation....of.population.                                              ***
People.using.at.least.basic.drinking.water.services....of.population.                            ***
People.using.at.least.basic.sanitation.services....of.population.                                ***
Population.density..people.per.sq..km.of.land.area.                                                 
Water.productivity..total..constant.2015.US..GDP.per.cubic.meter.of.total.freshwater.withdrawal.    
Level.of.water.stress..freshwater.withdrawal.as.a.proportion.of.available.freshwater.resources   ***
People.using.safely.managed.drinking.water.services....of.population.                            ***
People.using.safely.managed.sanitation.services....of.population.                                   
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Total Sum of Squares:    157.97
Residual Sum of Squares: 10.169
R-Squared:      0.93563
Adj. R-Squared: 0.92854
F-statistic: 214.394 on 8 and 118 DF, p-value: &lt; 2.22e-16</code></pre>
</div>
</div>
<p>The below code chunk fits a Fixed Effects Model also known as the â€˜withinâ€™ model) using the <code>plm</code> function from the <code>plm</code> package in R analyse the relationship between <code>TyphoidRate</code> and WASH indicators.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">plm</span>(TyphoidRate<span class="sc">~</span> </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  People.practicing.open.defecation....of.population. <span class="sc">+</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  People.using.at.least.basic.drinking.water.services....of.population. <span class="sc">+</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  People.using.at.least.basic.sanitation.services....of.population. <span class="sc">+</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  Population.density..people.per.sq..km.of.land.area. <span class="sc">+</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  Water.productivity..total..constant.<span class="fl">2015.</span>US..GDP.per.cubic.meter.of.total.freshwater.withdrawal. <span class="sc">+</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  Level.of.water.stress..freshwater.withdrawal.as.a.proportion.of.available.freshwater.resources <span class="sc">+</span>  <span class="co"># Level of water stress</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  People.using.safely.managed.drinking.water.services....of.population. <span class="sc">+</span>  <span class="co"># People using safely managed drinking water services</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  People.using.safely.managed.sanitation.services....of.population.,  <span class="co"># People using safely managed sanitation services</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> pdata,</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> <span class="st">"within"</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Oneway (individual) effect Within Model

Call:
plm(formula = TyphoidRate ~ People.practicing.open.defecation....of.population. + 
    People.using.at.least.basic.drinking.water.services....of.population. + 
    People.using.at.least.basic.sanitation.services....of.population. + 
    Population.density..people.per.sq..km.of.land.area. + Water.productivity..total..constant.2015.US..GDP.per.cubic.meter.of.total.freshwater.withdrawal. + 
    Level.of.water.stress..freshwater.withdrawal.as.a.proportion.of.available.freshwater.resources + 
    People.using.safely.managed.drinking.water.services....of.population. + 
    People.using.safely.managed.sanitation.services....of.population., 
    data = pdata, model = "within")

Balanced Panel: n = 6, T = 22, N = 132

Residuals:
       Min.     1st Qu.      Median     3rd Qu.        Max. 
-1.3345e-02 -1.7639e-03  3.2779e-05  1.9438e-03  6.7478e-03 

Coefficients:
                                                                                                    Estimate
People.practicing.open.defecation....of.population.                                               1.5961e-02
People.using.at.least.basic.drinking.water.services....of.population.                             1.8088e-02
People.using.at.least.basic.sanitation.services....of.population.                                 2.4683e-03
Population.density..people.per.sq..km.of.land.area.                                               9.1629e-05
Water.productivity..total..constant.2015.US..GDP.per.cubic.meter.of.total.freshwater.withdrawal.  1.1884e-05
Level.of.water.stress..freshwater.withdrawal.as.a.proportion.of.available.freshwater.resources   -4.1832e-04
People.using.safely.managed.drinking.water.services....of.population.                            -4.9622e-03
People.using.safely.managed.sanitation.services....of.population.                                -2.0081e-03
                                                                                                  Std. Error
People.practicing.open.defecation....of.population.                                               8.4282e-04
People.using.at.least.basic.drinking.water.services....of.population.                             7.8794e-04
People.using.at.least.basic.sanitation.services....of.population.                                 7.1113e-04
Population.density..people.per.sq..km.of.land.area.                                               4.0810e-05
Water.productivity..total..constant.2015.US..GDP.per.cubic.meter.of.total.freshwater.withdrawal.  8.8568e-06
Level.of.water.stress..freshwater.withdrawal.as.a.proportion.of.available.freshwater.resources    2.6861e-05
People.using.safely.managed.drinking.water.services....of.population.                             7.7724e-04
People.using.safely.managed.sanitation.services....of.population.                                 9.5846e-04
                                                                                                  t-value
People.practicing.open.defecation....of.population.                                               18.9370
People.using.at.least.basic.drinking.water.services....of.population.                             22.9557
People.using.at.least.basic.sanitation.services....of.population.                                  3.4710
Population.density..people.per.sq..km.of.land.area.                                                2.2452
Water.productivity..total..constant.2015.US..GDP.per.cubic.meter.of.total.freshwater.withdrawal.   1.3418
Level.of.water.stress..freshwater.withdrawal.as.a.proportion.of.available.freshwater.resources   -15.5736
People.using.safely.managed.drinking.water.services....of.population.                             -6.3844
People.using.safely.managed.sanitation.services....of.population.                                 -2.0952
                                                                                                  Pr(&gt;|t|)
People.practicing.open.defecation....of.population.                                              &lt; 2.2e-16
People.using.at.least.basic.drinking.water.services....of.population.                            &lt; 2.2e-16
People.using.at.least.basic.sanitation.services....of.population.                                0.0007252
Population.density..people.per.sq..km.of.land.area.                                              0.0266147
Water.productivity..total..constant.2015.US..GDP.per.cubic.meter.of.total.freshwater.withdrawal. 0.1822283
Level.of.water.stress..freshwater.withdrawal.as.a.proportion.of.available.freshwater.resources   &lt; 2.2e-16
People.using.safely.managed.drinking.water.services....of.population.                             3.53e-09
People.using.safely.managed.sanitation.services....of.population.                                0.0382947
                                                                                                    
People.practicing.open.defecation....of.population.                                              ***
People.using.at.least.basic.drinking.water.services....of.population.                            ***
People.using.at.least.basic.sanitation.services....of.population.                                ***
Population.density..people.per.sq..km.of.land.area.                                              *  
Water.productivity..total..constant.2015.US..GDP.per.cubic.meter.of.total.freshwater.withdrawal.    
Level.of.water.stress..freshwater.withdrawal.as.a.proportion.of.available.freshwater.resources   ***
People.using.safely.managed.drinking.water.services....of.population.                            ***
People.using.safely.managed.sanitation.services....of.population.                                *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Total Sum of Squares:    0.062059
Residual Sum of Squares: 0.001288
R-Squared:      0.97925
Adj. R-Squared: 0.97696
F-statistic: 695.932 on 8 and 118 DF, p-value: &lt; 2.22e-16</code></pre>
</div>
</div>
<p>Base on the output of four model, People practicing open defecation and People using at least basic drinking water services are significant across all models, consistently showing a negative relationship with health outcomes. <code>Level of water stress</code> appears as significant in most models, suggesting that regions facing higher water stress tend to experience worse health outcomes. <code>People using safely managed drinking water services</code> has significant positive impacts on <code>DiarrheaRate</code> and <code>UnsafeRisk</code>, but it is not significant for <code>HepatitisRate</code>.</p>
<p>The models explaining <code>HepatitisRate</code> and <code>UnsafeRisk</code> have very high R-squared values (above 94%), suggesting that these models explain most of the variance in the respective dependent variables.The <code>DiarrheaRate</code> model has a slightly lower R-squared (85.4%), but still a very good fit.</p>
<p>The results show that sanitation, drinking water access, and open defecation are important factors influencing health outcomes, particularly <code>DiarrheaRate</code> and <code>UnsafeRisk</code>.Water stress plays a critical role, indicating that regions with high water stress are likely to face more health-related challenges.There is considerable variation in the impact of predictors on different health outcomes, with some predictors (e.g., <code>People using safely managed drinking water services</code>) being more influential for some health outcomes than others.</p>
</section>
<section id="coefficient-list" class="level2">
<h2 class="anchored" data-anchor-id="coefficient-list">4.4 Coefficient list</h2>
<p>The code chunk below create a list of coefficient for four different health outcome, <code>DiarrheaRate</code>, <code>TyphoidRate</code>, <code>UnsafeRisk</code>, and <code>HepatitisRate</code> from the fixed effects models.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>coef_list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">DiarrheaRate =</span> <span class="fu">c</span>(</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">OpenDefecation =</span> <span class="sc">-</span><span class="fl">0.6755407</span>,</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">BasicWater =</span> <span class="sc">-</span><span class="fl">1.0144098</span>,</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">BasicSanitation =</span> <span class="sc">-</span><span class="fl">0.1706479</span>,</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">WaterProductivity =</span> <span class="fl">0.0029523</span>,</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">WaterStress =</span> <span class="fl">0.0110199</span>,</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">PopulationDensity =</span> <span class="fl">0.0014148</span>,</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">SafelyManagedWater =</span> <span class="fl">0.2855646</span>,</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">SafelyManagedSanitation =</span> <span class="sc">-</span><span class="fl">0.1302516</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">TyphoidRate =</span> <span class="fu">c</span>(</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">OpenDefecation =</span> <span class="fl">0.015961</span>,</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">BasicWater =</span> <span class="fl">0.018088</span>,</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">BasicSanitation =</span> <span class="fl">0.0024683</span>,</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">WaterProductivity =</span> <span class="fl">1.1884e-05</span>,</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">WaterStress =</span> <span class="sc">-</span><span class="fl">4.1832e-04</span>,</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">PopulationDensity =</span> <span class="fl">9.1629e-05</span>,</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">SafelyManagedWater =</span> <span class="sc">-</span><span class="fl">4.9622e-03</span>,</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">SafelyManagedSanitation =</span> <span class="sc">-</span><span class="fl">2.0081e-03</span></span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">UnsafeRisk =</span> <span class="fu">c</span>(</span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">OpenDefecation =</span> <span class="fl">0.72708968</span>,</span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">BasicWater =</span> <span class="fl">0.43477443</span>,</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">BasicSanitation =</span> <span class="fl">0.21651056</span>,</span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">WaterProductivity =</span> <span class="fl">0.00063762</span>,</span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">WaterStress =</span> <span class="sc">-</span><span class="fl">0.01913748</span>,</span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">PopulationDensity =</span> <span class="fl">0.00037018</span>,</span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">SafelyManagedWater =</span> <span class="sc">-</span><span class="fl">0.25010937</span>,</span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">SafelyManagedSanitation =</span> <span class="fl">0.04852111</span></span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">HepatitisRate =</span> <span class="fu">c</span>(</span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">OpenDefecation =</span> <span class="fl">0.0085691</span>,</span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">BasicWater =</span> <span class="fl">0.023667</span>,</span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">BasicSanitation =</span> <span class="sc">-</span><span class="fl">0.011585</span>,</span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">WaterProductivity =</span> <span class="fl">8.6247e-05</span>,</span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">WaterStress =</span> <span class="sc">-</span><span class="fl">0.0010463</span>,</span>
<span id="cb29-38"><a href="#cb29-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">PopulationDensity =</span> <span class="sc">-</span><span class="fl">3.7942e-04</span>,</span>
<span id="cb29-39"><a href="#cb29-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">SafelyManagedWater =</span> <span class="sc">-</span><span class="fl">3.6054e-03</span>,</span>
<span id="cb29-40"><a href="#cb29-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">SafelyManagedSanitation =</span> <span class="sc">-</span><span class="fl">5.7112e-04</span></span>
<span id="cb29-41"><a href="#cb29-41" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb29-42"><a href="#cb29-42" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="time-series-analysis-for-period-2022-to-2030-for-wash-indicators" class="level1">
<h1>5. Time Series Analysis for period 2022 to 2030 for wash indicators</h1>
<section id="create-selected_data" class="level2">
<h2 class="anchored" data-anchor-id="create-selected_data">5.1 Create <code>selected_data</code></h2>
<p>The below code chunk use <code>dplyr</code> package to select all the variables that will be use for analysis in the <code>pdata</code>. This is done using the <code>select()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>selected_data <span class="ot">&lt;-</span> pdata <span class="sc">%&gt;%</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Region, Year, TyphoidRate, DiarrheaRate, HepatitisRate, </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>         UnsafeRisk, </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Level.of.water.stress..freshwater.withdrawal.as.a.proportion.of.available.freshwater.resources"</span>,</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>         <span class="st">"People.practicing.open.defecation....of.population."</span>,</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>         <span class="st">"People.using.at.least.basic.drinking.water.services....of.population."</span>,</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>         <span class="st">"People.using.at.least.basic.sanitation.services....of.population."</span>,</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>         <span class="st">"People.using.safely.managed.drinking.water.services....of.population."</span>,</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>         <span class="st">"People.using.safely.managed.sanitation.services....of.population."</span>,</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Population.density..people.per.sq..km.of.land.area."</span>,</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Water.productivity..total..constant.2015.US..GDP.per.cubic.meter.of.total.freshwater.withdrawal."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="converting-data-type" class="level3">
<h3 class="anchored" data-anchor-id="converting-data-type">5.2 Converting Data type</h3>
<p>The function <code>class()</code> and <code>typeof()</code> provide different types of information about the Year column in the <code>selected_data.</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(selected_data<span class="sc">$</span>Year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "pseries" "factor" </code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(selected_data<span class="sc">$</span>Year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "integer"</code></pre>
</div>
</div>
<p>The below code chunk ensure that if the <code>Year</code> column in the <code>selected_data</code> is a factor it will be converted into a numeric format.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>selected_data<span class="sc">$</span>Year <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(selected_data<span class="sc">$</span>Year))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The below code chunk use function <code>extract_year()</code> that extracts a 4-digit year from a mixed string and then cleans the <code>Year</code> column in your <code>selected_data</code> dataset by applying this function. Finally, it converts the <code>Year</code> to a Date format representing the first day of the year.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>extract_year <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  year <span class="ot">&lt;-</span> <span class="fu">str_extract</span>(x, <span class="st">"</span><span class="sc">\\</span><span class="st">d{4}"</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">as.numeric</span>(year))</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>selected_data<span class="sc">$</span>Year <span class="ot">&lt;-</span> <span class="fu">extract_year</span>(selected_data<span class="sc">$</span>Year)</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>selected_data<span class="sc">$</span>YearDate <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">paste0</span>(selected_data<span class="sc">$</span>Year, <span class="st">"-01-01"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The below code chunk using str() function provides a compact display the structure of the an object, including its type and other relevant details. The <code>str(selected_data$Year)</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the type of the 'Year' column</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(selected_data<span class="sc">$</span>Year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> 'pseries' Named num [1:132] 2000 2001 2002 2003 2004 ...
 - attr(*, "names")= chr [1:132] "African Region-2000" "African Region-2001" "African Region-2002" "African Region-2003" ...
 - attr(*, "index")=Classes 'pindex' and 'data.frame':  132 obs. of  2 variables:
  ..$ Region: Factor w/ 6 levels "African Region",..: 1 1 1 1 1 1 1 1 1 1 ...
  ..$ Year  : Factor w/ 22 levels "2000","2001",..: 1 2 3 4 5 6 7 8 9 10 ...</code></pre>
</div>
</div>
</section>
<section id="times-series-analysis-using-arima" class="level3">
<h3 class="anchored" data-anchor-id="times-series-analysis-using-arima">5.3 Times Series Analysis using ARIMA</h3>
<p>The below code chunk perform ARIMA (Auto-Regression Integrated Moving Average) time series forecasting for WHO regions based on historical data. It generate the WASH indicators and population from 2022 to 2030.<br>
The code chunk processes data region-by-region, checks the availability of necessary data, fits ARIMA models, and returns the forecasted values for the next several years, which can be used for policy planning, resource allocation, or trend analysis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>arima_forecast <span class="ot">&lt;-</span> <span class="cf">function</span>(data, <span class="at">forecast_start_year =</span> <span class="dv">2022</span>, <span class="at">forecast_end_year =</span> <span class="dv">2030</span>) {</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co">#define variable name </span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  forecast_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"WaterStress"</span> <span class="ot">=</span> <span class="st">"Level.of.water.stress..freshwater.withdrawal.as.a.proportion.of.available.freshwater.resources"</span>,</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"OpenDefecation"</span> <span class="ot">=</span> <span class="st">"People.practicing.open.defecation....of.population."</span>,</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"BasicWaterServices"</span> <span class="ot">=</span> <span class="st">"People.using.at.least.basic.drinking.water.services....of.population."</span>,</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"BasicSanitationServices"</span> <span class="ot">=</span> <span class="st">"People.using.at.least.basic.sanitation.services....of.population."</span>,</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SafeManagedWaterServices"</span> <span class="ot">=</span> <span class="st">"People.using.safely.managed.drinking.water.services....of.population."</span>,</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SafeManagedSanitationServices"</span> <span class="ot">=</span> <span class="st">"People.using.safely.managed.sanitation.services....of.population."</span>,</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"PopulationDensity"</span> <span class="ot">=</span> <span class="st">"Population.density..people.per.sq..km.of.land.area."</span>,</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"WaterProductivity"</span> <span class="ot">=</span> <span class="st">"Water.productivity..total..constant.2015.US..GDP.per.cubic.meter.of.total.freshwater.withdrawal."</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Print progress header</span></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"========================================</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Starting ARIMA forecasting for"</span>, forecast_start_year, <span class="st">"to"</span>, forecast_end_year, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"========================================</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Verify input data</span></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Verifying input data...</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Input data has"</span>, <span class="fu">nrow</span>(data), <span class="st">"rows and"</span>, <span class="fu">ncol</span>(data), <span class="st">"columns</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if required columns exist</span></span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>  required_cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Region"</span>, <span class="st">"Year"</span>)</span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>  missing_required <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(required_cols, <span class="fu">names</span>(data))</span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(missing_required) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Missing required columns: "</span>, <span class="fu">paste</span>(missing_required, <span class="at">collapse =</span> <span class="st">", "</span>))</span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check for variable columns</span></span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a>  available_vars <span class="ot">&lt;-</span> <span class="fu">intersect</span>(forecast_vars, <span class="fu">names</span>(data))</span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(available_vars) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"None of the forecast variables found in the data"</span>)</span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Found"</span>, <span class="fu">length</span>(available_vars), <span class="st">"out of"</span>, <span class="fu">length</span>(forecast_vars), <span class="st">"forecast variables</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get unique regions</span></span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a>  regions <span class="ot">&lt;-</span> <span class="fu">unique</span>(data<span class="sc">$</span>Region)</span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Found"</span>, <span class="fu">length</span>(regions), <span class="st">"regions:"</span>, <span class="fu">paste</span>(regions, <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">"</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb39-41"><a href="#cb39-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-42"><a href="#cb39-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create empty data frame for results</span></span>
<span id="cb39-43"><a href="#cb39-43" aria-hidden="true" tabindex="-1"></a>  all_forecasts <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb39-44"><a href="#cb39-44" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-45"><a href="#cb39-45" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Process each region</span></span>
<span id="cb39-46"><a href="#cb39-46" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (region <span class="cf">in</span> regions) {</span>
<span id="cb39-47"><a href="#cb39-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Processing region:"</span>, region, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb39-48"><a href="#cb39-48" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-49"><a href="#cb39-49" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter data for this region</span></span>
<span id="cb39-50"><a href="#cb39-50" aria-hidden="true" tabindex="-1"></a>    region_data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Region <span class="sc">==</span> region)</span>
<span id="cb39-51"><a href="#cb39-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"  Region has"</span>, <span class="fu">nrow</span>(region_data), <span class="st">"rows</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb39-52"><a href="#cb39-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-53"><a href="#cb39-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create an empty data frame for this region's forecasts</span></span>
<span id="cb39-54"><a href="#cb39-54" aria-hidden="true" tabindex="-1"></a>    region_forecasts <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb39-55"><a href="#cb39-55" aria-hidden="true" tabindex="-1"></a>      <span class="at">Region =</span> region,</span>
<span id="cb39-56"><a href="#cb39-56" aria-hidden="true" tabindex="-1"></a>      <span class="at">Year =</span> forecast_start_year<span class="sc">:</span>forecast_end_year,</span>
<span id="cb39-57"><a href="#cb39-57" aria-hidden="true" tabindex="-1"></a>      <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb39-58"><a href="#cb39-58" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb39-59"><a href="#cb39-59" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add DataType column</span></span>
<span id="cb39-60"><a href="#cb39-60" aria-hidden="true" tabindex="-1"></a>    region_forecasts<span class="sc">$</span>DataType <span class="ot">&lt;-</span> <span class="st">"Forecast"</span></span>
<span id="cb39-61"><a href="#cb39-61" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-62"><a href="#cb39-62" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Process each variable</span></span>
<span id="cb39-63"><a href="#cb39-63" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (short_name <span class="cf">in</span> <span class="fu">names</span>(forecast_vars)) {</span>
<span id="cb39-64"><a href="#cb39-64" aria-hidden="true" tabindex="-1"></a>      var_name <span class="ot">&lt;-</span> forecast_vars[short_name]</span>
<span id="cb39-65"><a href="#cb39-65" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"  Forecasting:"</span>, short_name, <span class="st">"("</span>, var_name, <span class="st">")</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb39-66"><a href="#cb39-66" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb39-67"><a href="#cb39-67" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Check if variable exists in data</span></span>
<span id="cb39-68"><a href="#cb39-68" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span>(var_name <span class="sc">%in%</span> <span class="fu">names</span>(region_data))) {</span>
<span id="cb39-69"><a href="#cb39-69" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="st">"    Variable not found in data, skipping</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb39-70"><a href="#cb39-70" aria-hidden="true" tabindex="-1"></a>        region_forecasts[[short_name]] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb39-71"><a href="#cb39-71" aria-hidden="true" tabindex="-1"></a>        <span class="cf">next</span></span>
<span id="cb39-72"><a href="#cb39-72" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb39-73"><a href="#cb39-73" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb39-74"><a href="#cb39-74" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Get historical data for this variable</span></span>
<span id="cb39-75"><a href="#cb39-75" aria-hidden="true" tabindex="-1"></a>      var_data <span class="ot">&lt;-</span> region_data <span class="sc">%&gt;%</span> </span>
<span id="cb39-76"><a href="#cb39-76" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="sc">!!</span><span class="fu">sym</span>(var_name)), Year <span class="sc">&lt;</span> forecast_start_year) <span class="sc">%&gt;%</span></span>
<span id="cb39-77"><a href="#cb39-77" aria-hidden="true" tabindex="-1"></a>        <span class="fu">arrange</span>(Year)</span>
<span id="cb39-78"><a href="#cb39-78" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb39-79"><a href="#cb39-79" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Check if enough data</span></span>
<span id="cb39-80"><a href="#cb39-80" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">nrow</span>(var_data) <span class="sc">&lt;</span> <span class="dv">5</span>) {</span>
<span id="cb39-81"><a href="#cb39-81" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="st">"    Insufficient historical data (need at least 5 points), skipping</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb39-82"><a href="#cb39-82" aria-hidden="true" tabindex="-1"></a>        region_forecasts[[short_name]] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb39-83"><a href="#cb39-83" aria-hidden="true" tabindex="-1"></a>        <span class="cf">next</span></span>
<span id="cb39-84"><a href="#cb39-84" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb39-85"><a href="#cb39-85" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb39-86"><a href="#cb39-86" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Create time series</span></span>
<span id="cb39-87"><a href="#cb39-87" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"    Creating time series with"</span>, <span class="fu">nrow</span>(var_data), <span class="st">"points from"</span>, </span>
<span id="cb39-88"><a href="#cb39-88" aria-hidden="true" tabindex="-1"></a>          <span class="fu">min</span>(var_data<span class="sc">$</span>Year), <span class="st">"to"</span>, <span class="fu">max</span>(var_data<span class="sc">$</span>Year), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb39-89"><a href="#cb39-89" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb39-90"><a href="#cb39-90" aria-hidden="true" tabindex="-1"></a>      ts_data <span class="ot">&lt;-</span> <span class="fu">ts</span>(var_data[[var_name]], </span>
<span id="cb39-91"><a href="#cb39-91" aria-hidden="true" tabindex="-1"></a>                   <span class="at">start =</span> <span class="fu">min</span>(var_data<span class="sc">$</span>Year), </span>
<span id="cb39-92"><a href="#cb39-92" aria-hidden="true" tabindex="-1"></a>                   <span class="at">end =</span> <span class="fu">max</span>(var_data<span class="sc">$</span>Year), </span>
<span id="cb39-93"><a href="#cb39-93" aria-hidden="true" tabindex="-1"></a>                   <span class="at">frequency =</span> <span class="dv">1</span>)</span>
<span id="cb39-94"><a href="#cb39-94" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb39-95"><a href="#cb39-95" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Fit ARIMA model and forecast</span></span>
<span id="cb39-96"><a href="#cb39-96" aria-hidden="true" tabindex="-1"></a>      <span class="fu">tryCatch</span>({</span>
<span id="cb39-97"><a href="#cb39-97" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="st">"    Fitting ARIMA model...</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb39-98"><a href="#cb39-98" aria-hidden="true" tabindex="-1"></a>        arima_model <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(ts_data, <span class="at">seasonal =</span> <span class="cn">FALSE</span>, <span class="at">stepwise =</span> <span class="cn">TRUE</span>)</span>
<span id="cb39-99"><a href="#cb39-99" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-100"><a href="#cb39-100" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Print model information</span></span>
<span id="cb39-101"><a href="#cb39-101" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="st">"    Model:"</span>, <span class="fu">arimaorder</span>(arima_model), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb39-102"><a href="#cb39-102" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-103"><a href="#cb39-103" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Generate forecast</span></span>
<span id="cb39-104"><a href="#cb39-104" aria-hidden="true" tabindex="-1"></a>        forecast_years <span class="ot">&lt;-</span> forecast_end_year <span class="sc">-</span> forecast_start_year <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb39-105"><a href="#cb39-105" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="st">"    Generating"</span>, forecast_years, <span class="st">"year forecast...</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb39-106"><a href="#cb39-106" aria-hidden="true" tabindex="-1"></a>        forecast_result <span class="ot">&lt;-</span> <span class="fu">forecast</span>(arima_model, <span class="at">h =</span> forecast_years)</span>
<span id="cb39-107"><a href="#cb39-107" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-108"><a href="#cb39-108" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add forecast to results</span></span>
<span id="cb39-109"><a href="#cb39-109" aria-hidden="true" tabindex="-1"></a>        region_forecasts[[short_name]] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(forecast_result<span class="sc">$</span>mean)</span>
<span id="cb39-110"><a href="#cb39-110" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-111"><a href="#cb39-111" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Print forecast summary</span></span>
<span id="cb39-112"><a href="#cb39-112" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="st">"    Forecast summary - First:"</span>, <span class="fu">round</span>(forecast_result<span class="sc">$</span>mean[<span class="dv">1</span>], <span class="dv">4</span>),</span>
<span id="cb39-113"><a href="#cb39-113" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Last:"</span>, <span class="fu">round</span>(forecast_result<span class="sc">$</span>mean[forecast_years], <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb39-114"><a href="#cb39-114" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-115"><a href="#cb39-115" aria-hidden="true" tabindex="-1"></a>      }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb39-116"><a href="#cb39-116" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="st">"    Error in forecasting:"</span>, e<span class="sc">$</span>message, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb39-117"><a href="#cb39-117" aria-hidden="true" tabindex="-1"></a>        region_forecasts[[short_name]] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb39-118"><a href="#cb39-118" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb39-119"><a href="#cb39-119" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb39-120"><a href="#cb39-120" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-121"><a href="#cb39-121" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add this region's forecasts to the overall results</span></span>
<span id="cb39-122"><a href="#cb39-122" aria-hidden="true" tabindex="-1"></a>    all_forecasts <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(all_forecasts, region_forecasts)</span>
<span id="cb39-123"><a href="#cb39-123" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"  Completed forecasts for"</span>, region, <span class="st">"</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb39-124"><a href="#cb39-124" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb39-125"><a href="#cb39-125" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-126"><a href="#cb39-126" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Print summary</span></span>
<span id="cb39-127"><a href="#cb39-127" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"========================================</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb39-128"><a href="#cb39-128" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"ARIMA forecasting complete</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb39-129"><a href="#cb39-129" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Generated forecasts for"</span>, <span class="fu">nrow</span>(all_forecasts), <span class="st">"rows</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb39-130"><a href="#cb39-130" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Forecasted variables:"</span>, <span class="fu">paste</span>(<span class="fu">names</span>(all_forecasts)[<span class="sc">!</span>(<span class="fu">names</span>(all_forecasts) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Region"</span>, <span class="st">"Year"</span>, <span class="st">"DataType"</span>))], <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb39-131"><a href="#cb39-131" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"========================================</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb39-132"><a href="#cb39-132" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-133"><a href="#cb39-133" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return the clean format results with short names</span></span>
<span id="cb39-134"><a href="#cb39-134" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(all_forecasts)</span>
<span id="cb39-135"><a href="#cb39-135" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The below code chunk run the <code>arima_forecast</code> from above code chunk, generating forecasts for year 2022 to 2030. The resulting forecasted data is then saved to a csv file name <code>water_sanitation_forecasts.csv</code> .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a> forecast_data <span class="ot">&lt;-</span><span class="fu">arima_forecast</span>(selected_data, </span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">forecast_start_year =</span> <span class="dv">2022</span>, </span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">forecast_end_year =</span> <span class="dv">2030</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>========================================
Starting ARIMA forecasting for 2022 to 2030 
========================================

Verifying input data...
Input data has 132 rows and 15 columns
Found 8 out of 8 forecast variables
Found 6 regions: African Region, Eastern Mediterranean Region, European Region, Region of the Americas, South-East Asia Region, Western Pacific Region 

Processing region: African Region 
  Region has 22 rows
  Forecasting: WaterStress ( Level.of.water.stress..freshwater.withdrawal.as.a.proportion.of.available.freshwater.resources )
    Creating time series with 22 points from 2000 to 2021 
    Fitting ARIMA model...
    Model: 1 1 0 
    Generating 9 year forecast...
    Forecast summary - First: 13.6691 Last: 15.0825 
  Forecasting: OpenDefecation ( People.practicing.open.defecation....of.population. )
    Creating time series with 22 points from 2000 to 2021 
    Fitting ARIMA model...
    Model: 1 2 0 
    Generating 9 year forecast...
    Forecast summary - First: 16.6458 Last: 12.6728 
  Forecasting: BasicWaterServices ( People.using.at.least.basic.drinking.water.services....of.population. )
    Creating time series with 22 points from 2000 to 2021 
    Fitting ARIMA model...
    Model: 1 1 0 
    Generating 9 year forecast...
    Forecast summary - First: 71.0816 Last: 76.0508 
  Forecasting: BasicSanitationServices ( People.using.at.least.basic.sanitation.services....of.population. )
    Creating time series with 22 points from 2000 to 2021 
    Fitting ARIMA model...
    Model: 1 1 1 
    Generating 9 year forecast...
    Forecast summary - First: 41.3846 Last: 46.1911 
  Forecasting: SafeManagedWaterServices ( People.using.safely.managed.drinking.water.services....of.population. )
    Creating time series with 22 points from 2000 to 2021 
    Fitting ARIMA model...
    Model: 1 1 0 
    Generating 9 year forecast...
    Forecast summary - First: 26.6579 Last: 29.7478 
  Forecasting: SafeManagedSanitationServices ( People.using.safely.managed.sanitation.services....of.population. )
    Creating time series with 22 points from 2000 to 2021 
    Fitting ARIMA model...
    Model: 1 1 0 
    Generating 9 year forecast...
    Forecast summary - First: 23.602 Last: 26.1116 
  Forecasting: PopulationDensity ( Population.density..people.per.sq..km.of.land.area. )
    Creating time series with 22 points from 2000 to 2021 
    Fitting ARIMA model...
    Model: 0 2 0 
    Generating 9 year forecast...
    Forecast summary - First: 123.6346 Last: 142.6114 
  Forecasting: WaterProductivity ( Water.productivity..total..constant.2015.US..GDP.per.cubic.meter.of.total.freshwater.withdrawal. )
    Creating time series with 22 points from 2000 to 2021 
    Fitting ARIMA model...
    Model: 0 2 1 
    Generating 9 year forecast...
    Forecast summary - First: 50.8416 Last: 51.5612 
  Completed forecasts for African Region 

Processing region: Eastern Mediterranean Region 
  Region has 22 rows
  Forecasting: WaterStress ( Level.of.water.stress..freshwater.withdrawal.as.a.proportion.of.available.freshwater.resources )
    Creating time series with 22 points from 2000 to 2021 
    Fitting ARIMA model...
    Model: 0 1 1 
    Generating 9 year forecast...
    Forecast summary - First: 434.4198 Last: 477.9403 
  Forecasting: OpenDefecation ( People.practicing.open.defecation....of.population. )
    Creating time series with 22 points from 2000 to 2021 
    Fitting ARIMA model...
    Model: 1 1 0 
    Generating 9 year forecast...
    Forecast summary - First: 3.4662 Last: 0.4362 
  Forecasting: BasicWaterServices ( People.using.at.least.basic.drinking.water.services....of.population. )
    Creating time series with 22 points from 2000 to 2021 
    Fitting ARIMA model...
    Model: 1 1 0 
    Generating 9 year forecast...
    Forecast summary - First: 90.1361 Last: 93.579 
  Forecasting: BasicSanitationServices ( People.using.at.least.basic.sanitation.services....of.population. )
    Creating time series with 22 points from 2000 to 2021 
    Fitting ARIMA model...
    Model: 1 1 1 
    Generating 9 year forecast...
    Forecast summary - First: 87.4697 Last: 89.1055 
  Forecasting: SafeManagedWaterServices ( People.using.safely.managed.drinking.water.services....of.population. )
    Creating time series with 22 points from 2000 to 2021 
    Fitting ARIMA model...
    Model: 3 1 0 
    Generating 9 year forecast...
    Forecast summary - First: 75.6946 Last: 76.178 
  Forecasting: SafeManagedSanitationServices ( People.using.safely.managed.sanitation.services....of.population. )
    Creating time series with 22 points from 2000 to 2021 
    Fitting ARIMA model...
    Model: 1 2 1 
    Generating 9 year forecast...
    Forecast summary - First: 63.9669 Last: 61.6175 
  Forecasting: PopulationDensity ( Population.density..people.per.sq..km.of.land.area. )
    Creating time series with 22 points from 2000 to 2021 
    Fitting ARIMA model...
    Model: 0 1 1 
    Generating 9 year forecast...
    Forecast summary - First: 246.9798 Last: 287.6959 
  Forecasting: WaterProductivity ( Water.productivity..total..constant.2015.US..GDP.per.cubic.meter.of.total.freshwater.withdrawal. )
    Creating time series with 22 points from 2000 to 2021 
    Fitting ARIMA model...
    Model: 0 1 0 
    Generating 9 year forecast...
    Forecast summary - First: 75.2812 Last: 90.2432 
  Completed forecasts for Eastern Mediterranean Region 

Processing region: European Region 
  Region has 22 rows
  Forecasting: WaterStress ( Level.of.water.stress..freshwater.withdrawal.as.a.proportion.of.available.freshwater.resources )
    Creating time series with 22 points from 2000 to 2021 
    Fitting ARIMA model...
    Model: 0 1 0 
    Generating 9 year forecast...
    Forecast summary - First: 29.106 Last: 27.9702 
  Forecasting: OpenDefecation ( People.practicing.open.defecation....of.population. )
    Creating time series with 22 points from 2000 to 2021 
    Fitting ARIMA model...
    Model: 1 2 0 
    Generating 9 year forecast...
    Forecast summary - First: 0.0173 Last: 0.0163 
  Forecasting: BasicWaterServices ( People.using.at.least.basic.drinking.water.services....of.population. )
    Creating time series with 22 points from 2000 to 2021 
    Fitting ARIMA model...
    Model: 1 2 0 
    Generating 9 year forecast...
    Forecast summary - First: 98.219 Last: 98.4982 
  Forecasting: BasicSanitationServices ( People.using.at.least.basic.sanitation.services....of.population. )
    Creating time series with 22 points from 2000 to 2021 
    Fitting ARIMA model...
    Model: 1 1 1 
    Generating 9 year forecast...
    Forecast summary - First: 97.367 Last: 97.6688 
  Forecasting: SafeManagedWaterServices ( People.using.safely.managed.drinking.water.services....of.population. )
    Creating time series with 22 points from 2000 to 2021 
    Fitting ARIMA model...
    Model: 1 2 0 
    Generating 9 year forecast...
    Forecast summary - First: 91.6315 Last: 91.4817 
  Forecasting: SafeManagedSanitationServices ( People.using.safely.managed.sanitation.services....of.population. )
    Creating time series with 22 points from 2000 to 2021 
    Fitting ARIMA model...
    Model: 3 1 0 
    Generating 9 year forecast...
    Forecast summary - First: 81.1007 Last: 84.2264 
  Forecasting: PopulationDensity ( Population.density..people.per.sq..km.of.land.area. )
    Creating time series with 22 points from 2000 to 2021 
    Fitting ARIMA model...
    Model: 1 1 0 
    Generating 9 year forecast...
    Forecast summary - First: 510.6295 Last: 487.6131 
  Forecasting: WaterProductivity ( Water.productivity..total..constant.2015.US..GDP.per.cubic.meter.of.total.freshwater.withdrawal. )
    Creating time series with 22 points from 2000 to 2021 
    Fitting ARIMA model...
    Model: 0 1 0 
    Generating 9 year forecast...
    Forecast summary - First: 166.4738 Last: 197.3617 
  Completed forecasts for European Region 

Processing region: Region of the Americas 
  Region has 22 rows
  Forecasting: WaterStress ( Level.of.water.stress..freshwater.withdrawal.as.a.proportion.of.available.freshwater.resources )
    Creating time series with 22 points from 2000 to 2021 
    Fitting ARIMA model...
    Model: 0 1 0 
    Generating 9 year forecast...
    Forecast summary - First: 14.7549 Last: 15.361 
  Forecasting: OpenDefecation ( People.practicing.open.defecation....of.population. )
    Creating time series with 22 points from 2000 to 2021 
    Fitting ARIMA model...
    Model: 1 2 0 
    Generating 9 year forecast...
    Forecast summary - First: 2.0797 Last: 1.1645 
  Forecasting: BasicWaterServices ( People.using.at.least.basic.drinking.water.services....of.population. )
    Creating time series with 22 points from 2000 to 2021 
    Fitting ARIMA model...
    Model: 0 2 1 
    Generating 9 year forecast...
    Forecast summary - First: 96.0721 Last: 97.3119 
  Forecasting: BasicSanitationServices ( People.using.at.least.basic.sanitation.services....of.population. )
    Creating time series with 22 points from 2000 to 2021 
    Fitting ARIMA model...
    Model: 0 1 1 
    Generating 9 year forecast...
    Forecast summary - First: 88.8033 Last: 93.0552 
  Forecasting: SafeManagedWaterServices ( People.using.safely.managed.drinking.water.services....of.population. )
    Creating time series with 22 points from 2000 to 2021 
    Fitting ARIMA model...
    Model: 2 1 0 
    Generating 9 year forecast...
    Forecast summary - First: 70.6284 Last: 73.344 
  Forecasting: SafeManagedSanitationServices ( People.using.safely.managed.sanitation.services....of.population. )
    Creating time series with 22 points from 2000 to 2021 
    Fitting ARIMA model...
    Model: 0 1 2 
    Generating 9 year forecast...
    Forecast summary - First: 50.1699 Last: 53.2325 
  Forecasting: PopulationDensity ( Population.density..people.per.sq..km.of.land.area. )
    Creating time series with 22 points from 2000 to 2021 
    Fitting ARIMA model...
    Model: 0 2 0 
    Generating 9 year forecast...
    Forecast summary - First: 136.9497 Last: 140.3939 
  Forecasting: WaterProductivity ( Water.productivity..total..constant.2015.US..GDP.per.cubic.meter.of.total.freshwater.withdrawal. )
    Creating time series with 22 points from 2000 to 2021 
    Fitting ARIMA model...
    Model: 0 1 0 
    Generating 9 year forecast...
    Forecast summary - First: 39.9161 Last: 39.9161 
  Completed forecasts for Region of the Americas 

Processing region: South-East Asia Region 
  Region has 22 rows
  Forecasting: WaterStress ( Level.of.water.stress..freshwater.withdrawal.as.a.proportion.of.available.freshwater.resources )
    Creating time series with 22 points from 2000 to 2021 
    Fitting ARIMA model...
    Model: 0 1 0 
    Generating 9 year forecast...
    Forecast summary - First: 34.9278 Last: 34.9278 
  Forecasting: OpenDefecation ( People.practicing.open.defecation....of.population. )
    Creating time series with 22 points from 2000 to 2021 
    Fitting ARIMA model...
    Model: 1 2 0 
    Generating 9 year forecast...
    Forecast summary - First: 2.9154 Last: -2.8741 
  Forecasting: BasicWaterServices ( People.using.at.least.basic.drinking.water.services....of.population. )
    Creating time series with 22 points from 2000 to 2021 
    Fitting ARIMA model...
    Model: 0 2 0 
    Generating 9 year forecast...
    Forecast summary - First: 94.3236 Last: 97.5214 
  Forecasting: BasicSanitationServices ( People.using.at.least.basic.sanitation.services....of.population. )
    Creating time series with 22 points from 2000 to 2021 
    Fitting ARIMA model...
    Model: 0 2 0 
    Generating 9 year forecast...
    Forecast summary - First: 84.3762 Last: 96.7598 
  Forecasting: SafeManagedWaterServices ( People.using.safely.managed.drinking.water.services....of.population. )
    Creating time series with 22 points from 2000 to 2021 
    Fitting ARIMA model...
    Model: 0 2 0 
    Generating 9 year forecast...
    Forecast summary - First: 50.2925 Last: 53.7727 
  Forecasting: SafeManagedSanitationServices ( People.using.safely.managed.sanitation.services....of.population. )
    Creating time series with 22 points from 2000 to 2021 
    Fitting ARIMA model...
    Model: 0 2 0 
    Generating 9 year forecast...
    Forecast summary - First: 45.787 Last: 54.3177 
  Forecasting: PopulationDensity ( Population.density..people.per.sq..km.of.land.area. )
    Creating time series with 22 points from 2000 to 2021 
    Fitting ARIMA model...
    Model: 0 2 0 
    Generating 9 year forecast...
    Forecast summary - First: 437.9126 Last: 490.0413 
  Forecasting: WaterProductivity ( Water.productivity..total..constant.2015.US..GDP.per.cubic.meter.of.total.freshwater.withdrawal. )
    Creating time series with 22 points from 2000 to 2021 
    Fitting ARIMA model...
    Model: 0 0 0 
    Generating 9 year forecast...
    Forecast summary - First: 143.4833 Last: 143.4833 
  Completed forecasts for South-East Asia Region 

Processing region: Western Pacific Region 
  Region has 22 rows
  Forecasting: WaterStress ( Level.of.water.stress..freshwater.withdrawal.as.a.proportion.of.available.freshwater.resources )
    Creating time series with 22 points from 2000 to 2021 
    Fitting ARIMA model...
    Model: 1 1 0 
    Generating 9 year forecast...
    Forecast summary - First: 24.028 Last: 24.3192 
  Forecasting: OpenDefecation ( People.practicing.open.defecation....of.population. )
    Creating time series with 22 points from 2000 to 2021 
    Fitting ARIMA model...
    Model: 1 2 0 
    Generating 9 year forecast...
    Forecast summary - First: 6.4089 Last: 4.2022 
  Forecasting: BasicWaterServices ( People.using.at.least.basic.drinking.water.services....of.population. )
    Creating time series with 22 points from 2000 to 2021 
    Fitting ARIMA model...
    Model: 0 2 0 
    Generating 9 year forecast...
    Forecast summary - First: 90.9617 Last: 93.5111 
  Forecasting: BasicSanitationServices ( People.using.at.least.basic.sanitation.services....of.population. )
    Creating time series with 22 points from 2000 to 2021 
    Fitting ARIMA model...
    Model: 1 1 1 
    Generating 9 year forecast...
    Forecast summary - First: 81.5416 Last: 85.5992 
  Forecasting: SafeManagedWaterServices ( People.using.safely.managed.drinking.water.services....of.population. )
    Creating time series with 22 points from 2000 to 2021 
    Fitting ARIMA model...
    Model: 0 1 0 
    Generating 9 year forecast...
    Forecast summary - First: 55.5271 Last: 58.4247 
  Forecasting: SafeManagedSanitationServices ( People.using.safely.managed.sanitation.services....of.population. )
    Creating time series with 22 points from 2000 to 2021 
    Fitting ARIMA model...
    Model: 1 2 0 
    Generating 9 year forecast...
    Forecast summary - First: 65.9229 Last: 66.8086 
  Forecasting: PopulationDensity ( Population.density..people.per.sq..km.of.land.area. )
    Creating time series with 22 points from 2000 to 2021 
    Fitting ARIMA model...
    Model: 0 1 1 
    Generating 9 year forecast...
    Forecast summary - First: 453.8227 Last: 481.3429 
  Forecasting: WaterProductivity ( Water.productivity..total..constant.2015.US..GDP.per.cubic.meter.of.total.freshwater.withdrawal. )
    Creating time series with 22 points from 2000 to 2021 
    Fitting ARIMA model...
    Model: 0 1 0 
    Generating 9 year forecast...
    Forecast summary - First: 118.3247 Last: 146.8719 
  Completed forecasts for Western Pacific Region 

========================================
ARIMA forecasting complete
Generated forecasts for 54 rows
Forecasted variables: WaterStress, OpenDefecation, BasicWaterServices, BasicSanitationServices, SafeManagedWaterServices, SafeManagedSanitationServices, PopulationDensity, WaterProductivity 
========================================</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">write.csv</span>(forecast_data, <span class="st">"water_sanitation_forecasts.csv"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="forecast-for-health-indicator" class="level1">
<h1>6. Forecast for health indicator</h1>
<section id="apply-coefficient-to-forecast-data" class="level2">
<h2 class="anchored" data-anchor-id="apply-coefficient-to-forecast-data">6.1 Apply coefficient to forecast data</h2>
<p>The below code chunk generates predictions for disease rates (Diarrhea, Typhoid, Unsafe Risk, and Hepatitis) based on forecasted changes in key water and sanitation variables (e.g., open defecation, basic water services, population density) for each region. The function first retrieves baseline values from the historical data for 2021, then calculates the forecasted disease rates for each region between 2022 and 2030 by applying coefficients that quantify the impact of changes in the variables. It iterates over each region and variable, adjusting the baseline values according to the forecasted changes, and ensures that negative disease values are set to zero. The function returns the updated dataset with forecasted disease rates.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>predict_diseases <span class="ot">&lt;-</span> <span class="cf">function</span>(forecast_data, selected_data) {</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  var_mapping <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Level.of.water.stress..freshwater.withdrawal.as.a.proportion.of.available.freshwater.resources"</span> <span class="ot">=</span> <span class="st">"WaterStress"</span>,</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"People.practicing.open.defecation....of.population."</span> <span class="ot">=</span> <span class="st">"OpenDefecation"</span>,</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"People.using.at.least.basic.drinking.water.services....of.population."</span> <span class="ot">=</span> <span class="st">"BasicWaterServices"</span>,</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"People.using.at.least.basic.sanitation.services....of.population."</span> <span class="ot">=</span> <span class="st">"BasicSanitationServices"</span>,</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"People.using.safely.managed.drinking.water.services....of.population."</span> <span class="ot">=</span> <span class="st">"SafeManagedWaterServices"</span>,</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"People.using.safely.managed.sanitation.services....of.population."</span> <span class="ot">=</span> <span class="st">"SafeManagedSanitationServices"</span>,</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Population.density..people.per.sq..km.of.land.area."</span> <span class="ot">=</span> <span class="st">"PopulationDensity"</span>,</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Water.productivity..total..constant.2015.US..GDP.per.cubic.meter.of.total.freshwater.withdrawal."</span> <span class="ot">=</span> <span class="st">"WaterProductivity"</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>  historical <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(selected_data)</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>  baseline <span class="ot">&lt;-</span> historical[historical<span class="sc">$</span>Year <span class="sc">==</span> <span class="dv">2021</span>, ]</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>  coef_list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">DiarrheaRate =</span> <span class="fu">c</span>(</span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">OpenDefecation =</span> <span class="sc">-</span><span class="fl">0.6755407</span>,</span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">BasicWaterServices =</span> <span class="sc">-</span><span class="fl">1.0144098</span>,</span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">BasicSanitationServices =</span> <span class="sc">-</span><span class="fl">0.1706479</span>,</span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">WaterProductivity =</span> <span class="fl">0.0029523</span>,</span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">WaterStress =</span> <span class="fl">0.0110199</span>,</span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">PopulationDensity =</span> <span class="fl">0.0014148</span>,</span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">SafeManagedWaterServices =</span> <span class="fl">0.2855646</span>,</span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">SafeManagedSanitationServices =</span> <span class="sc">-</span><span class="fl">0.1302516</span></span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb43-31"><a href="#cb43-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">TyphoidRate =</span> <span class="fu">c</span>(</span>
<span id="cb43-32"><a href="#cb43-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">OpenDefecation =</span> <span class="fl">0.015961</span>,</span>
<span id="cb43-33"><a href="#cb43-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">BasicWaterServices =</span> <span class="fl">0.018088</span>,</span>
<span id="cb43-34"><a href="#cb43-34" aria-hidden="true" tabindex="-1"></a>      <span class="at">BasicSanitationServices =</span> <span class="fl">0.0024683</span>,</span>
<span id="cb43-35"><a href="#cb43-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">WaterProductivity =</span> <span class="fl">1.1884e-05</span>,</span>
<span id="cb43-36"><a href="#cb43-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">WaterStress =</span> <span class="sc">-</span><span class="fl">4.1832e-04</span>,</span>
<span id="cb43-37"><a href="#cb43-37" aria-hidden="true" tabindex="-1"></a>      <span class="at">PopulationDensity =</span> <span class="fl">9.1629e-05</span>,</span>
<span id="cb43-38"><a href="#cb43-38" aria-hidden="true" tabindex="-1"></a>      <span class="at">SafeManagedWaterServices =</span> <span class="sc">-</span><span class="fl">4.9622e-03</span>,</span>
<span id="cb43-39"><a href="#cb43-39" aria-hidden="true" tabindex="-1"></a>      <span class="at">SafeManagedSanitationServices =</span> <span class="sc">-</span><span class="fl">2.0081e-03</span></span>
<span id="cb43-40"><a href="#cb43-40" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb43-41"><a href="#cb43-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">UnsafeRisk =</span> <span class="fu">c</span>(</span>
<span id="cb43-42"><a href="#cb43-42" aria-hidden="true" tabindex="-1"></a>      <span class="at">OpenDefecation =</span> <span class="fl">0.72708968</span>,</span>
<span id="cb43-43"><a href="#cb43-43" aria-hidden="true" tabindex="-1"></a>      <span class="at">BasicWaterServices =</span> <span class="fl">0.43477443</span>,</span>
<span id="cb43-44"><a href="#cb43-44" aria-hidden="true" tabindex="-1"></a>      <span class="at">BasicSanitationServices =</span> <span class="fl">0.21651056</span>,</span>
<span id="cb43-45"><a href="#cb43-45" aria-hidden="true" tabindex="-1"></a>      <span class="at">WaterProductivity =</span> <span class="fl">0.00063762</span>,</span>
<span id="cb43-46"><a href="#cb43-46" aria-hidden="true" tabindex="-1"></a>      <span class="at">WaterStress =</span> <span class="sc">-</span><span class="fl">0.01913748</span>,</span>
<span id="cb43-47"><a href="#cb43-47" aria-hidden="true" tabindex="-1"></a>      <span class="at">PopulationDensity =</span> <span class="fl">0.00037018</span>,</span>
<span id="cb43-48"><a href="#cb43-48" aria-hidden="true" tabindex="-1"></a>      <span class="at">SafeManagedWaterServices =</span> <span class="sc">-</span><span class="fl">0.25010937</span>,</span>
<span id="cb43-49"><a href="#cb43-49" aria-hidden="true" tabindex="-1"></a>      <span class="at">SafeManagedSanitationServices =</span> <span class="fl">0.04852111</span></span>
<span id="cb43-50"><a href="#cb43-50" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb43-51"><a href="#cb43-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">HepatitisRate =</span> <span class="fu">c</span>(</span>
<span id="cb43-52"><a href="#cb43-52" aria-hidden="true" tabindex="-1"></a>      <span class="at">OpenDefecation =</span> <span class="fl">0.0085691</span>,</span>
<span id="cb43-53"><a href="#cb43-53" aria-hidden="true" tabindex="-1"></a>      <span class="at">BasicWaterServices =</span> <span class="fl">0.023667</span>,</span>
<span id="cb43-54"><a href="#cb43-54" aria-hidden="true" tabindex="-1"></a>      <span class="at">BasicSanitationServices =</span> <span class="sc">-</span><span class="fl">0.011585</span>,</span>
<span id="cb43-55"><a href="#cb43-55" aria-hidden="true" tabindex="-1"></a>      <span class="at">WaterProductivity =</span> <span class="fl">8.6247e-05</span>,</span>
<span id="cb43-56"><a href="#cb43-56" aria-hidden="true" tabindex="-1"></a>      <span class="at">WaterStress =</span> <span class="sc">-</span><span class="fl">0.0010463</span>,</span>
<span id="cb43-57"><a href="#cb43-57" aria-hidden="true" tabindex="-1"></a>      <span class="at">PopulationDensity =</span> <span class="sc">-</span><span class="fl">3.7942e-04</span>,</span>
<span id="cb43-58"><a href="#cb43-58" aria-hidden="true" tabindex="-1"></a>      <span class="at">SafeManagedWaterServices =</span> <span class="sc">-</span><span class="fl">3.6054e-03</span>,</span>
<span id="cb43-59"><a href="#cb43-59" aria-hidden="true" tabindex="-1"></a>      <span class="at">SafeManagedSanitationServices =</span> <span class="sc">-</span><span class="fl">5.7112e-04</span></span>
<span id="cb43-60"><a href="#cb43-60" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb43-61"><a href="#cb43-61" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb43-62"><a href="#cb43-62" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb43-63"><a href="#cb43-63" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb43-64"><a href="#cb43-64" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> forecast_data</span>
<span id="cb43-65"><a href="#cb43-65" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb43-66"><a href="#cb43-66" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb43-67"><a href="#cb43-67" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (disease <span class="cf">in</span> <span class="fu">names</span>(coef_list)) {</span>
<span id="cb43-68"><a href="#cb43-68" aria-hidden="true" tabindex="-1"></a>    result[[disease]] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb43-69"><a href="#cb43-69" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb43-70"><a href="#cb43-70" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb43-71"><a href="#cb43-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-72"><a href="#cb43-72" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (region <span class="cf">in</span> <span class="fu">unique</span>(result<span class="sc">$</span>Region)) {</span>
<span id="cb43-73"><a href="#cb43-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-74"><a href="#cb43-74" aria-hidden="true" tabindex="-1"></a>    region_baseline <span class="ot">&lt;-</span> baseline[baseline<span class="sc">$</span>Region <span class="sc">==</span> region, ]</span>
<span id="cb43-75"><a href="#cb43-75" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-76"><a href="#cb43-76" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">nrow</span>(region_baseline) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb43-77"><a href="#cb43-77" aria-hidden="true" tabindex="-1"></a>      <span class="cf">next</span></span>
<span id="cb43-78"><a href="#cb43-78" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb43-79"><a href="#cb43-79" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-80"><a href="#cb43-80" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb43-81"><a href="#cb43-81" aria-hidden="true" tabindex="-1"></a>    region_rows <span class="ot">&lt;-</span> <span class="fu">which</span>(result<span class="sc">$</span>Region <span class="sc">==</span> region)</span>
<span id="cb43-82"><a href="#cb43-82" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-83"><a href="#cb43-83" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb43-84"><a href="#cb43-84" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (disease <span class="cf">in</span> <span class="fu">names</span>(coef_list)) {</span>
<span id="cb43-85"><a href="#cb43-85" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb43-86"><a href="#cb43-86" aria-hidden="true" tabindex="-1"></a>      baseline_value <span class="ot">&lt;-</span> region_baseline[[disease]]</span>
<span id="cb43-87"><a href="#cb43-87" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb43-88"><a href="#cb43-88" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (row <span class="cf">in</span> region_rows) {</span>
<span id="cb43-89"><a href="#cb43-89" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb43-90"><a href="#cb43-90" aria-hidden="true" tabindex="-1"></a>        result[row, disease] <span class="ot">&lt;-</span> baseline_value</span>
<span id="cb43-91"><a href="#cb43-91" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb43-92"><a href="#cb43-92" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (pred_name <span class="cf">in</span> <span class="fu">names</span>(coef_list[[disease]])) {</span>
<span id="cb43-93"><a href="#cb43-93" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb43-94"><a href="#cb43-94" aria-hidden="true" tabindex="-1"></a>          forecast_col <span class="ot">&lt;-</span> pred_name</span>
<span id="cb43-95"><a href="#cb43-95" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb43-96"><a href="#cb43-96" aria-hidden="true" tabindex="-1"></a>          historical_col <span class="ot">&lt;-</span> <span class="fu">names</span>(var_mapping)[var_mapping <span class="sc">==</span> forecast_col]</span>
<span id="cb43-97"><a href="#cb43-97" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb43-98"><a href="#cb43-98" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (<span class="fu">length</span>(historical_col) <span class="sc">==</span> <span class="dv">0</span> <span class="sc">||</span> <span class="sc">!</span>forecast_col <span class="sc">%in%</span> <span class="fu">names</span>(result)) {</span>
<span id="cb43-99"><a href="#cb43-99" aria-hidden="true" tabindex="-1"></a>            <span class="cf">next</span></span>
<span id="cb43-100"><a href="#cb43-100" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb43-101"><a href="#cb43-101" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb43-102"><a href="#cb43-102" aria-hidden="true" tabindex="-1"></a>          baseline_val <span class="ot">&lt;-</span> region_baseline[[historical_col]]</span>
<span id="cb43-103"><a href="#cb43-103" aria-hidden="true" tabindex="-1"></a>          forecast_val <span class="ot">&lt;-</span> result[row, forecast_col]</span>
<span id="cb43-104"><a href="#cb43-104" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb43-105"><a href="#cb43-105" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (<span class="fu">is.na</span>(baseline_val) <span class="sc">||</span> <span class="fu">is.na</span>(forecast_val)) {</span>
<span id="cb43-106"><a href="#cb43-106" aria-hidden="true" tabindex="-1"></a>            <span class="cf">next</span></span>
<span id="cb43-107"><a href="#cb43-107" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb43-108"><a href="#cb43-108" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb43-109"><a href="#cb43-109" aria-hidden="true" tabindex="-1"></a>          coef_val <span class="ot">&lt;-</span> coef_list[[disease]][pred_name]</span>
<span id="cb43-110"><a href="#cb43-110" aria-hidden="true" tabindex="-1"></a>          change <span class="ot">&lt;-</span> forecast_val <span class="sc">-</span> baseline_val</span>
<span id="cb43-111"><a href="#cb43-111" aria-hidden="true" tabindex="-1"></a>          effect <span class="ot">&lt;-</span> coef_val <span class="sc">*</span> change</span>
<span id="cb43-112"><a href="#cb43-112" aria-hidden="true" tabindex="-1"></a>          result[row, disease] <span class="ot">&lt;-</span> result[row, disease] <span class="sc">+</span> effect</span>
<span id="cb43-113"><a href="#cb43-113" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb43-114"><a href="#cb43-114" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb43-115"><a href="#cb43-115" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb43-116"><a href="#cb43-116" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb43-117"><a href="#cb43-117" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb43-118"><a href="#cb43-118" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Set all negative disease values to zero</span></span>
<span id="cb43-119"><a href="#cb43-119" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (disease <span class="cf">in</span> <span class="fu">names</span>(coef_list)) {</span>
<span id="cb43-120"><a href="#cb43-120" aria-hidden="true" tabindex="-1"></a>    negative_rows <span class="ot">&lt;-</span> <span class="fu">which</span>(result[[disease]] <span class="sc">&lt;</span> <span class="dv">0</span>)</span>
<span id="cb43-121"><a href="#cb43-121" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">length</span>(negative_rows) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb43-122"><a href="#cb43-122" aria-hidden="true" tabindex="-1"></a>      result[negative_rows, disease] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb43-123"><a href="#cb43-123" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb43-124"><a href="#cb43-124" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb43-125"><a href="#cb43-125" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb43-126"><a href="#cb43-126" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb43-127"><a href="#cb43-127" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The code chunk below runs the <code>predict_diseases</code> created above, generating the predicted disease rates for each region and year. It then saves the results to a csv file named <code>disease_predictions.csv</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>disease_forecasts <span class="ot">&lt;-</span> <span class="fu">predict_diseases</span>(forecast_data, selected_data)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(disease_forecasts, <span class="st">"disease_predictions.csv"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="merging-historical-data-with-forcasted-data" class="level1">
<h1>7. Merging Historical data with Forcasted data</h1>
<p>The code combines historical and forecasted data by first mapping the original water and sanitation variables from the <code>selected_data</code> dataset to standardized names, then cleaning and adding relevant columns for disease rates (e.g., DiarrheaRate, TyphoidRate) and water-related variables (e.g., WaterStress, PopulationDensity). It adds a <code>DataType</code> column to distinguish historical from forecast data, merges both datasets, and sorts them by Region and Year. Finally, the combined data is saved as a CSV file, <code>combined_complete_data.csv</code>, containing both historical and forecasted values for further analysis or reporting.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>historical_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Level.of.water.stress..freshwater.withdrawal.as.a.proportion.of.available.freshwater.resources"</span>,</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"People.practicing.open.defecation....of.population."</span>,</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"People.using.at.least.basic.drinking.water.services....of.population."</span>,</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"People.using.at.least.basic.sanitation.services....of.population."</span>,</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"People.using.safely.managed.drinking.water.services....of.population."</span>,</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"People.using.safely.managed.sanitation.services....of.population."</span>,</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Population.density..people.per.sq..km.of.land.area."</span>,</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Water.productivity..total..constant.2015.US..GDP.per.cubic.meter.of.total.freshwater.withdrawal."</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>forecast_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">"WaterStress"</span>,</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">"OpenDefecation"</span>,</span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BasicWaterServices"</span>,</span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BasicSanitationServices"</span>,</span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SafeManagedWaterServices"</span>, </span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SafeManagedSanitationServices"</span>,</span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PopulationDensity"</span>,</span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a>  <span class="st">"WaterProductivity"</span></span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a>var_mapping <span class="ot">&lt;-</span> <span class="fu">setNames</span>(forecast_vars, historical_vars)</span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-26"><a href="#cb45-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-27"><a href="#cb45-27" aria-hidden="true" tabindex="-1"></a>historical_data <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(selected_data)</span>
<span id="cb45-28"><a href="#cb45-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-29"><a href="#cb45-29" aria-hidden="true" tabindex="-1"></a>historical_data<span class="sc">$</span>DataType <span class="ot">&lt;-</span> <span class="st">"Historical"</span></span>
<span id="cb45-30"><a href="#cb45-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-31"><a href="#cb45-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-32"><a href="#cb45-32" aria-hidden="true" tabindex="-1"></a>historical_clean <span class="ot">&lt;-</span> historical_data[, <span class="fu">c</span>(<span class="st">"Region"</span>, <span class="st">"Year"</span>, <span class="st">"TyphoidRate"</span>, <span class="st">"DiarrheaRate"</span>, </span>
<span id="cb45-33"><a href="#cb45-33" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"HepatitisRate"</span>, <span class="st">"UnsafeRisk"</span>, <span class="st">"DataType"</span>)]</span>
<span id="cb45-34"><a href="#cb45-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-35"><a href="#cb45-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-36"><a href="#cb45-36" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (hist_var <span class="cf">in</span> <span class="fu">names</span>(var_mapping)) {</span>
<span id="cb45-37"><a href="#cb45-37" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (hist_var <span class="sc">%in%</span> <span class="fu">names</span>(historical_data)) {</span>
<span id="cb45-38"><a href="#cb45-38" aria-hidden="true" tabindex="-1"></a>    forecast_var <span class="ot">&lt;-</span> var_mapping[hist_var]</span>
<span id="cb45-39"><a href="#cb45-39" aria-hidden="true" tabindex="-1"></a>    historical_clean[[forecast_var]] <span class="ot">&lt;-</span> historical_data[[hist_var]]</span>
<span id="cb45-40"><a href="#cb45-40" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb45-41"><a href="#cb45-41" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb45-42"><a href="#cb45-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-43"><a href="#cb45-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-44"><a href="#cb45-44" aria-hidden="true" tabindex="-1"></a>combined_data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(historical_clean, disease_forecasts)</span>
<span id="cb45-45"><a href="#cb45-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-46"><a href="#cb45-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-47"><a href="#cb45-47" aria-hidden="true" tabindex="-1"></a>combined_data <span class="ot">&lt;-</span> combined_data[<span class="fu">order</span>(combined_data<span class="sc">$</span>Region, combined_data<span class="sc">$</span>Year), ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(combined_data, <span class="st">"combined_complete_data.csv"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="visualize-test-result" class="level1">
<h1>8. Visualize test result</h1>
<section id="importing-the-combined-data" class="level2">
<h2 class="anchored" data-anchor-id="importing-the-combined-data">8.1 Importing the combined data</h2>
<p>The below code chunk use <code>read.csv()</code> to read the <code>combined_complete_data.csv</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>combined_data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"combined_complete_data.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="plotting-for-visualization" class="level2">
<h2 class="anchored" data-anchor-id="plotting-for-visualization">8.2 plotting for visualization</h2>
<p>The below code chunk creates a line plot using <code>ggplot2</code> to visualise the historical result and forecast result of the <code>DiarrheaRate.</code><br>
The aim of the graph is to observe the change overtime.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(combined_data, <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> DiarrheaRate, <span class="at">color =</span> Region, <span class="at">linetype =</span> DataType)) <span class="sc">+</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Diarrhea Rate: Historical and Forecast"</span>, <span class="at">y =</span> <span class="st">"Rate"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Forcasting_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>combined_data_long <span class="ot">&lt;-</span> combined_data <span class="sc">%&gt;%</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(UnsafeRisk, WaterStress, OpenDefecation, BasicWaterServices, </span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>                        BasicSanitationServices, SafeManagedWaterServices, </span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>                        SafeManagedSanitationServices, WaterProductivity),</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"WASH_Variable"</span>, <span class="at">values_to =</span> <span class="st">"Value"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(combined_data_long, <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> Value, <span class="at">color =</span> Region, <span class="at">linetype =</span> DataType)) <span class="sc">+</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>WASH_Variable, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span>  <span class="co"># Facet by WASH variable</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"WASH Variables Over Time by Region"</span>, <span class="at">y =</span> <span class="st">"Value"</span>) <span class="sc">+</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Forcasting_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>combined_data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"combined_complete_data.csv"</span>)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>combined_data_long <span class="ot">&lt;-</span> combined_data <span class="sc">%&gt;%</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(UnsafeRisk, WaterStress, OpenDefecation, BasicWaterServices, </span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>                        BasicSanitationServices, SafeManagedWaterServices, </span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>                        SafeManagedSanitationServices, WaterProductivity,</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>                        TyphoidRate, DiarrheaRate, HepatitisRate),</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"Variable"</span>, <span class="at">values_to =</span> <span class="st">"Value"</span>)</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(combined_data_long, <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> Value, <span class="at">color =</span> Region, <span class="at">linetype =</span> DataType)) <span class="sc">+</span></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Variable, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span>  <span class="co"># Facet by variable (WASH + diseases)</span></span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"WASH and Disease Variables Over Time by Region"</span>, <span class="at">y =</span> <span class="st">"Value"</span>) <span class="sc">+</span></span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Forcasting_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="interactive-plot-using-plotly" class="level2">
<h2 class="anchored" data-anchor-id="interactive-plot-using-plotly">8.3 Interactive plot using plotly</h2>
<section id="import-data-1" class="level3">
<h3 class="anchored" data-anchor-id="import-data-1">8.3.1 Import Data</h3>
<p>The below code chunk use <code>read_csv()</code> to read the csv file into R as a data frame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"combined_complete_data.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="visualizing-the-change-over-time-through-interactive-plot" class="level3">
<h3 class="anchored" data-anchor-id="visualizing-the-change-over-time-through-interactive-plot">8.3.2 Visualizing the change over time through interactive plot</h3>
<p>The below code chunk use <code>plotly</code> to visualise the change overtime of health indicator <code>TyphoidRate</code> of all region.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>interactive_plot <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>(data, </span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>                            <span class="at">x =</span> <span class="sc">~</span>Year, </span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>                            <span class="at">y =</span> <span class="sc">~</span>TyphoidRate, </span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>                            <span class="at">color =</span> <span class="sc">~</span>Region,   </span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>                            <span class="at">type =</span> <span class="st">'scatter'</span>, </span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>                            <span class="at">mode =</span> <span class="st">'lines+markers'</span>,  </span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>                            <span class="at">hoverinfo =</span> <span class="st">'text'</span>, </span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>                            <span class="at">text =</span> <span class="sc">~</span><span class="fu">paste</span>(<span class="st">'Year: '</span>, Year, <span class="st">'&lt;br&gt;Typhoid Rate: '</span>, <span class="fu">round</span>(TyphoidRate, <span class="dv">2</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(<span class="at">title =</span> <span class="st">"Interactive Time Series of Typhoid Rate by Region"</span>,</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"Year"</span>),</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"Typhoid Rate"</span>))</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>interactive_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-c9d75dec267e9ce61611" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-c9d75dec267e9ce61611">{"x":{"visdat":{"5c306771694d":["function () ","plotlyVisDat"]},"cur_data":"5c306771694d","attrs":{"5c306771694d":{"x":{},"y":{},"mode":"lines+markers","hoverinfo":"text","text":{},"color":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Interactive Time Series of Typhoid Rate by Region","xaxis":{"domain":[0,1],"automargin":true,"title":"Year"},"yaxis":{"domain":[0,1],"automargin":true,"title":"Typhoid Rate"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2023,2024,2025,2026,2027,2028,2029,2030],"y":[0.040000000000000001,0.040000000000000001,0.040000000000000001,0.040000000000000001,0.040000000000000001,0.040000000000000001,0.040000000000000001,0.040000000000000001,0.029999999999999999,0.029999999999999999,0.029999999999999999,0.029999999999999999,0.029999999999999999,0.029999999999999999,0.029999999999999999,0.029999999999999999,0.029999999999999999,0.02,0.02,0.02,0.02,0.02,0.021010486038386299,0.022476105958460699,0.024315083027783901,0.026459170526871401,0.028852419445156902,0.031449367947848902,0.034213227006120298,0.0371142681891427,0.040128464594288697],"mode":"lines+markers","hoverinfo":["text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text"],"text":["Year:  2000 <br>Typhoid Rate:  0.04","Year:  2001 <br>Typhoid Rate:  0.04","Year:  2002 <br>Typhoid Rate:  0.04","Year:  2003 <br>Typhoid Rate:  0.04","Year:  2004 <br>Typhoid Rate:  0.04","Year:  2005 <br>Typhoid Rate:  0.04","Year:  2006 <br>Typhoid Rate:  0.04","Year:  2007 <br>Typhoid Rate:  0.04","Year:  2008 <br>Typhoid Rate:  0.03","Year:  2009 <br>Typhoid Rate:  0.03","Year:  2010 <br>Typhoid Rate:  0.03","Year:  2011 <br>Typhoid Rate:  0.03","Year:  2012 <br>Typhoid Rate:  0.03","Year:  2013 <br>Typhoid Rate:  0.03","Year:  2014 <br>Typhoid Rate:  0.03","Year:  2015 <br>Typhoid Rate:  0.03","Year:  2016 <br>Typhoid Rate:  0.03","Year:  2017 <br>Typhoid Rate:  0.02","Year:  2018 <br>Typhoid Rate:  0.02","Year:  2019 <br>Typhoid Rate:  0.02","Year:  2020 <br>Typhoid Rate:  0.02","Year:  2021 <br>Typhoid Rate:  0.02","Year:  2022 <br>Typhoid Rate:  0.02","Year:  2023 <br>Typhoid Rate:  0.02","Year:  2024 <br>Typhoid Rate:  0.02","Year:  2025 <br>Typhoid Rate:  0.03","Year:  2026 <br>Typhoid Rate:  0.03","Year:  2027 <br>Typhoid Rate:  0.03","Year:  2028 <br>Typhoid Rate:  0.03","Year:  2029 <br>Typhoid Rate:  0.04","Year:  2030 <br>Typhoid Rate:  0.04"],"type":"scatter","name":"African Region","marker":{"color":"rgba(102,194,165,1)","line":{"color":"rgba(102,194,165,1)"}},"textfont":{"color":"rgba(102,194,165,1)"},"error_y":{"color":"rgba(102,194,165,1)"},"error_x":{"color":"rgba(102,194,165,1)"},"line":{"color":"rgba(102,194,165,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2023,2024,2025,2026,2027,2028,2029,2030],"y":[0.059999999999999998,0.059999999999999998,0.050000000000000003,0.050000000000000003,0.050000000000000003,0.050000000000000003,0.050000000000000003,0.040000000000000001,0.040000000000000001,0.040000000000000001,0.040000000000000001,0.040000000000000001,0.040000000000000001,0.040000000000000001,0.029999999999999999,0.029999999999999999,0.029999999999999999,0.029999999999999999,0.029999999999999999,0.029999999999999999,0.029999999999999999,0.02,0.020386625165075199,0.020530954020047901,0.0208582358364089,0.021411129743926401,0.0221327555766095,0.023018894437897699,0.024031486422026301,0.025154323270655098,0.0263610510239457],"mode":"lines+markers","hoverinfo":["text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text"],"text":["Year:  2000 <br>Typhoid Rate:  0.06","Year:  2001 <br>Typhoid Rate:  0.06","Year:  2002 <br>Typhoid Rate:  0.05","Year:  2003 <br>Typhoid Rate:  0.05","Year:  2004 <br>Typhoid Rate:  0.05","Year:  2005 <br>Typhoid Rate:  0.05","Year:  2006 <br>Typhoid Rate:  0.05","Year:  2007 <br>Typhoid Rate:  0.04","Year:  2008 <br>Typhoid Rate:  0.04","Year:  2009 <br>Typhoid Rate:  0.04","Year:  2010 <br>Typhoid Rate:  0.04","Year:  2011 <br>Typhoid Rate:  0.04","Year:  2012 <br>Typhoid Rate:  0.04","Year:  2013 <br>Typhoid Rate:  0.04","Year:  2014 <br>Typhoid Rate:  0.03","Year:  2015 <br>Typhoid Rate:  0.03","Year:  2016 <br>Typhoid Rate:  0.03","Year:  2017 <br>Typhoid Rate:  0.03","Year:  2018 <br>Typhoid Rate:  0.03","Year:  2019 <br>Typhoid Rate:  0.03","Year:  2020 <br>Typhoid Rate:  0.03","Year:  2021 <br>Typhoid Rate:  0.02","Year:  2022 <br>Typhoid Rate:  0.02","Year:  2023 <br>Typhoid Rate:  0.02","Year:  2024 <br>Typhoid Rate:  0.02","Year:  2025 <br>Typhoid Rate:  0.02","Year:  2026 <br>Typhoid Rate:  0.02","Year:  2027 <br>Typhoid Rate:  0.02","Year:  2028 <br>Typhoid Rate:  0.02","Year:  2029 <br>Typhoid Rate:  0.03","Year:  2030 <br>Typhoid Rate:  0.03"],"type":"scatter","name":"Eastern Mediterranean Region","marker":{"color":"rgba(252,141,98,1)","line":{"color":"rgba(252,141,98,1)"}},"textfont":{"color":"rgba(252,141,98,1)"},"error_y":{"color":"rgba(252,141,98,1)"},"error_x":{"color":"rgba(252,141,98,1)"},"line":{"color":"rgba(252,141,98,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2023,2024,2025,2026,2027,2028,2029,2030],"y":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3.5346152131381098e-05,6.6550976705585595e-05,5.6013959773226302e-05,0,0,0,0,0,0],"mode":"lines+markers","hoverinfo":["text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text"],"text":["Year:  2000 <br>Typhoid Rate:  0","Year:  2001 <br>Typhoid Rate:  0","Year:  2002 <br>Typhoid Rate:  0","Year:  2003 <br>Typhoid Rate:  0","Year:  2004 <br>Typhoid Rate:  0","Year:  2005 <br>Typhoid Rate:  0","Year:  2006 <br>Typhoid Rate:  0","Year:  2007 <br>Typhoid Rate:  0","Year:  2008 <br>Typhoid Rate:  0","Year:  2009 <br>Typhoid Rate:  0","Year:  2010 <br>Typhoid Rate:  0","Year:  2011 <br>Typhoid Rate:  0","Year:  2012 <br>Typhoid Rate:  0","Year:  2013 <br>Typhoid Rate:  0","Year:  2014 <br>Typhoid Rate:  0","Year:  2015 <br>Typhoid Rate:  0","Year:  2016 <br>Typhoid Rate:  0","Year:  2017 <br>Typhoid Rate:  0","Year:  2018 <br>Typhoid Rate:  0","Year:  2019 <br>Typhoid Rate:  0","Year:  2020 <br>Typhoid Rate:  0","Year:  2021 <br>Typhoid Rate:  0","Year:  2022 <br>Typhoid Rate:  0","Year:  2023 <br>Typhoid Rate:  0","Year:  2024 <br>Typhoid Rate:  0","Year:  2025 <br>Typhoid Rate:  0","Year:  2026 <br>Typhoid Rate:  0","Year:  2027 <br>Typhoid Rate:  0","Year:  2028 <br>Typhoid Rate:  0","Year:  2029 <br>Typhoid Rate:  0","Year:  2030 <br>Typhoid Rate:  0"],"type":"scatter","name":"European Region","marker":{"color":"rgba(141,160,203,1)","line":{"color":"rgba(141,160,203,1)"}},"textfont":{"color":"rgba(141,160,203,1)"},"error_y":{"color":"rgba(141,160,203,1)"},"error_x":{"color":"rgba(141,160,203,1)"},"line":{"color":"rgba(141,160,203,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2023,2024,2025,2026,2027,2028,2029,2030],"y":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"mode":"lines+markers","hoverinfo":["text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text"],"text":["Year:  2000 <br>Typhoid Rate:  0","Year:  2001 <br>Typhoid Rate:  0","Year:  2002 <br>Typhoid Rate:  0","Year:  2003 <br>Typhoid Rate:  0","Year:  2004 <br>Typhoid Rate:  0","Year:  2005 <br>Typhoid Rate:  0","Year:  2006 <br>Typhoid Rate:  0","Year:  2007 <br>Typhoid Rate:  0","Year:  2008 <br>Typhoid Rate:  0","Year:  2009 <br>Typhoid Rate:  0","Year:  2010 <br>Typhoid Rate:  0","Year:  2011 <br>Typhoid Rate:  0","Year:  2012 <br>Typhoid Rate:  0","Year:  2013 <br>Typhoid Rate:  0","Year:  2014 <br>Typhoid Rate:  0","Year:  2015 <br>Typhoid Rate:  0","Year:  2016 <br>Typhoid Rate:  0","Year:  2017 <br>Typhoid Rate:  0","Year:  2018 <br>Typhoid Rate:  0","Year:  2019 <br>Typhoid Rate:  0","Year:  2020 <br>Typhoid Rate:  0","Year:  2021 <br>Typhoid Rate:  0","Year:  2022 <br>Typhoid Rate:  0","Year:  2023 <br>Typhoid Rate:  0","Year:  2024 <br>Typhoid Rate:  0","Year:  2025 <br>Typhoid Rate:  0","Year:  2026 <br>Typhoid Rate:  0","Year:  2027 <br>Typhoid Rate:  0","Year:  2028 <br>Typhoid Rate:  0","Year:  2029 <br>Typhoid Rate:  0","Year:  2030 <br>Typhoid Rate:  0"],"type":"scatter","name":"Region of the Americas","marker":{"color":"rgba(231,138,195,1)","line":{"color":"rgba(231,138,195,1)"}},"textfont":{"color":"rgba(231,138,195,1)"},"error_y":{"color":"rgba(231,138,195,1)"},"error_x":{"color":"rgba(231,138,195,1)"},"line":{"color":"rgba(231,138,195,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2023,2024,2025,2026,2027,2028,2029,2030],"y":[0.22,0.22,0.20999999999999999,0.20000000000000001,0.19,0.17999999999999999,0.17999999999999999,0.17000000000000001,0.16,0.16,0.14999999999999999,0.14000000000000001,0.13,0.12,0.10000000000000001,0.10000000000000001,0.089999999999999997,0.080000000000000002,0.080000000000000002,0.070000000000000007,0.070000000000000007,0.059999999999999998,0.0550318223752971,0.050699554095956501,0.046451397466508497,0.042246802015020402,0.038064766770443702,0.033894415391173799,0.029730115051641502,0.025568948527926402,0.0214094049982755],"mode":"lines+markers","hoverinfo":["text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text"],"text":["Year:  2000 <br>Typhoid Rate:  0.22","Year:  2001 <br>Typhoid Rate:  0.22","Year:  2002 <br>Typhoid Rate:  0.21","Year:  2003 <br>Typhoid Rate:  0.2","Year:  2004 <br>Typhoid Rate:  0.19","Year:  2005 <br>Typhoid Rate:  0.18","Year:  2006 <br>Typhoid Rate:  0.18","Year:  2007 <br>Typhoid Rate:  0.17","Year:  2008 <br>Typhoid Rate:  0.16","Year:  2009 <br>Typhoid Rate:  0.16","Year:  2010 <br>Typhoid Rate:  0.15","Year:  2011 <br>Typhoid Rate:  0.14","Year:  2012 <br>Typhoid Rate:  0.13","Year:  2013 <br>Typhoid Rate:  0.12","Year:  2014 <br>Typhoid Rate:  0.1","Year:  2015 <br>Typhoid Rate:  0.1","Year:  2016 <br>Typhoid Rate:  0.09","Year:  2017 <br>Typhoid Rate:  0.08","Year:  2018 <br>Typhoid Rate:  0.08","Year:  2019 <br>Typhoid Rate:  0.07","Year:  2020 <br>Typhoid Rate:  0.07","Year:  2021 <br>Typhoid Rate:  0.06","Year:  2022 <br>Typhoid Rate:  0.06","Year:  2023 <br>Typhoid Rate:  0.05","Year:  2024 <br>Typhoid Rate:  0.05","Year:  2025 <br>Typhoid Rate:  0.04","Year:  2026 <br>Typhoid Rate:  0.04","Year:  2027 <br>Typhoid Rate:  0.03","Year:  2028 <br>Typhoid Rate:  0.03","Year:  2029 <br>Typhoid Rate:  0.03","Year:  2030 <br>Typhoid Rate:  0.02"],"type":"scatter","name":"South-East Asia Region","marker":{"color":"rgba(166,216,84,1)","line":{"color":"rgba(166,216,84,1)"}},"textfont":{"color":"rgba(166,216,84,1)"},"error_y":{"color":"rgba(166,216,84,1)"},"error_x":{"color":"rgba(166,216,84,1)"},"line":{"color":"rgba(166,216,84,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2023,2024,2025,2026,2027,2028,2029,2030],"y":[0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.0097669068593474895,0.010580209040295101,0.011449319943940399,0.012357258419408899,0.0132952430995033,0.014257813467813799,0.0152410307829611,0.0162417866819984,0.0172575145292857],"mode":"lines+markers","hoverinfo":["text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text"],"text":["Year:  2000 <br>Typhoid Rate:  0.01","Year:  2001 <br>Typhoid Rate:  0.01","Year:  2002 <br>Typhoid Rate:  0.01","Year:  2003 <br>Typhoid Rate:  0.01","Year:  2004 <br>Typhoid Rate:  0.01","Year:  2005 <br>Typhoid Rate:  0.01","Year:  2006 <br>Typhoid Rate:  0.01","Year:  2007 <br>Typhoid Rate:  0.01","Year:  2008 <br>Typhoid Rate:  0.01","Year:  2009 <br>Typhoid Rate:  0.01","Year:  2010 <br>Typhoid Rate:  0.01","Year:  2011 <br>Typhoid Rate:  0.01","Year:  2012 <br>Typhoid Rate:  0.01","Year:  2013 <br>Typhoid Rate:  0.01","Year:  2014 <br>Typhoid Rate:  0.01","Year:  2015 <br>Typhoid Rate:  0.01","Year:  2016 <br>Typhoid Rate:  0.01","Year:  2017 <br>Typhoid Rate:  0.01","Year:  2018 <br>Typhoid Rate:  0.01","Year:  2019 <br>Typhoid Rate:  0.01","Year:  2020 <br>Typhoid Rate:  0.01","Year:  2021 <br>Typhoid Rate:  0.01","Year:  2022 <br>Typhoid Rate:  0.01","Year:  2023 <br>Typhoid Rate:  0.01","Year:  2024 <br>Typhoid Rate:  0.01","Year:  2025 <br>Typhoid Rate:  0.01","Year:  2026 <br>Typhoid Rate:  0.01","Year:  2027 <br>Typhoid Rate:  0.01","Year:  2028 <br>Typhoid Rate:  0.02","Year:  2029 <br>Typhoid Rate:  0.02","Year:  2030 <br>Typhoid Rate:  0.02"],"type":"scatter","name":"Western Pacific Region","marker":{"color":"rgba(255,217,47,1)","line":{"color":"rgba(255,217,47,1)"}},"textfont":{"color":"rgba(255,217,47,1)"},"error_y":{"color":"rgba(255,217,47,1)"},"error_x":{"color":"rgba(255,217,47,1)"},"line":{"color":"rgba(255,217,47,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>The below code chunk use <code>plotly</code> to visualise the change over time of Wash Indicator <code>waterstress</code> in all region.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>wash_indicator <span class="ot">&lt;-</span> <span class="st">"WaterStress"</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>interactive_plot <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>(data, </span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>                            <span class="at">x =</span> <span class="sc">~</span>Year, </span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>                            <span class="at">y =</span> <span class="sc">~</span><span class="fu">get</span>(wash_indicator),  </span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>                            <span class="at">color =</span> <span class="sc">~</span>Region,   </span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>                            <span class="at">type =</span> <span class="st">'scatter'</span>, </span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>                            <span class="at">mode =</span> <span class="st">'lines+markers'</span>,  </span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>                            <span class="at">hoverinfo =</span> <span class="st">'text'</span>, </span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>                            <span class="at">text =</span> <span class="sc">~</span><span class="fu">paste</span>(<span class="st">'Year: '</span>, Year, <span class="st">'&lt;br&gt;'</span>, wash_indicator, <span class="st">': '</span>, <span class="fu">round</span>(<span class="fu">get</span>(wash_indicator), <span class="dv">2</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(<span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Interactive Time Series of"</span>, wash_indicator, <span class="st">"by Region"</span>),</span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"Year"</span>,</span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>                      <span class="at">rangeslider =</span> <span class="fu">list</span>(<span class="at">type =</span> <span class="st">"date"</span>),  </span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>                      <span class="at">type =</span> <span class="st">"linear"</span>),  </span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> wash_indicator),</span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">dragmode =</span> <span class="st">"pan"</span>)</span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a>interactive_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-191d70ef8ae96a02db42" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-191d70ef8ae96a02db42">{"x":{"visdat":{"5c30362b1f4e":["function () ","plotlyVisDat"]},"cur_data":"5c30362b1f4e","attrs":{"5c30362b1f4e":{"x":{},"y":{},"mode":"lines+markers","hoverinfo":"text","text":{},"color":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Interactive Time Series of WaterStress by Region","xaxis":{"domain":[0,1],"automargin":true,"title":"Year","rangeslider":{"type":"date"},"type":"linear"},"yaxis":{"domain":[0,1],"automargin":true,"title":"WaterStress"},"dragmode":"pan","hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2023,2024,2025,2026,2027,2028,2029,2030],"y":[9.7249961192790693,10.072695124116301,10.4342041774884,10.6377752702326,10.770590627116301,10.900407315651201,11.0060801463953,11.074553885674399,11.325059991976699,11.337547330813999,11.4675968210465,11.5101247349302,11.6138817665814,11.710134353767399,12.0320834771628,12.3628064656512,12.676668333093,12.8696058509535,13.1425029552093,13.320040605697701,13.504773063441901,13.548635983441899,13.669075444493901,13.82396666739,13.9943577271533,14.1717221586704,14.3522239079562,14.534137135523901,14.716685386728701,14.899519334869099,15.0824818179712],"mode":"lines+markers","hoverinfo":["text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text"],"text":["Year:  2000 <br> WaterStress :  9.72","Year:  2001 <br> WaterStress :  10.07","Year:  2002 <br> WaterStress :  10.43","Year:  2003 <br> WaterStress :  10.64","Year:  2004 <br> WaterStress :  10.77","Year:  2005 <br> WaterStress :  10.9","Year:  2006 <br> WaterStress :  11.01","Year:  2007 <br> WaterStress :  11.07","Year:  2008 <br> WaterStress :  11.33","Year:  2009 <br> WaterStress :  11.34","Year:  2010 <br> WaterStress :  11.47","Year:  2011 <br> WaterStress :  11.51","Year:  2012 <br> WaterStress :  11.61","Year:  2013 <br> WaterStress :  11.71","Year:  2014 <br> WaterStress :  12.03","Year:  2015 <br> WaterStress :  12.36","Year:  2016 <br> WaterStress :  12.68","Year:  2017 <br> WaterStress :  12.87","Year:  2018 <br> WaterStress :  13.14","Year:  2019 <br> WaterStress :  13.32","Year:  2020 <br> WaterStress :  13.5","Year:  2021 <br> WaterStress :  13.55","Year:  2022 <br> WaterStress :  13.67","Year:  2023 <br> WaterStress :  13.82","Year:  2024 <br> WaterStress :  13.99","Year:  2025 <br> WaterStress :  14.17","Year:  2026 <br> WaterStress :  14.35","Year:  2027 <br> WaterStress :  14.53","Year:  2028 <br> WaterStress :  14.72","Year:  2029 <br> WaterStress :  14.9","Year:  2030 <br> WaterStress :  15.08"],"type":"scatter","name":"African Region","marker":{"color":"rgba(102,194,165,1)","line":{"color":"rgba(102,194,165,1)"}},"textfont":{"color":"rgba(102,194,165,1)"},"error_y":{"color":"rgba(102,194,165,1)"},"error_x":{"color":"rgba(102,194,165,1)"},"line":{"color":"rgba(102,194,165,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2023,2024,2025,2026,2027,2028,2029,2030],"y":[313.24872813014298,317.843334160143,323.52431830109498,327.69483584347603,344.64885773919002,361.85682491347598,369.53542471442898,374.34900272966701,379.06383514585701,383.48448880823798,388.10109175776199,392.07299570823801,397.69536000918998,402.10869055109498,405.651544748238,410.82459342157102,417.91852618919,431.47636042109502,433.74706415014299,433.30836534061899,431.25374006871402,430.39879168061901,434.41978041510498,439.85984918203201,445.29991794896,450.73998671588703,456.18005548281502,461.62012424974301,467.06019301666998,472.50026178359701,477.940330550525],"mode":"lines+markers","hoverinfo":["text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text"],"text":["Year:  2000 <br> WaterStress :  313.25","Year:  2001 <br> WaterStress :  317.84","Year:  2002 <br> WaterStress :  323.52","Year:  2003 <br> WaterStress :  327.69","Year:  2004 <br> WaterStress :  344.65","Year:  2005 <br> WaterStress :  361.86","Year:  2006 <br> WaterStress :  369.54","Year:  2007 <br> WaterStress :  374.35","Year:  2008 <br> WaterStress :  379.06","Year:  2009 <br> WaterStress :  383.48","Year:  2010 <br> WaterStress :  388.1","Year:  2011 <br> WaterStress :  392.07","Year:  2012 <br> WaterStress :  397.7","Year:  2013 <br> WaterStress :  402.11","Year:  2014 <br> WaterStress :  405.65","Year:  2015 <br> WaterStress :  410.82","Year:  2016 <br> WaterStress :  417.92","Year:  2017 <br> WaterStress :  431.48","Year:  2018 <br> WaterStress :  433.75","Year:  2019 <br> WaterStress :  433.31","Year:  2020 <br> WaterStress :  431.25","Year:  2021 <br> WaterStress :  430.4","Year:  2022 <br> WaterStress :  434.42","Year:  2023 <br> WaterStress :  439.86","Year:  2024 <br> WaterStress :  445.3","Year:  2025 <br> WaterStress :  450.74","Year:  2026 <br> WaterStress :  456.18","Year:  2027 <br> WaterStress :  461.62","Year:  2028 <br> WaterStress :  467.06","Year:  2029 <br> WaterStress :  472.5","Year:  2030 <br> WaterStress :  477.94"],"type":"scatter","name":"Eastern Mediterranean Region","marker":{"color":"rgba(252,141,98,1)","line":{"color":"rgba(252,141,98,1)"}},"textfont":{"color":"rgba(252,141,98,1)"},"error_y":{"color":"rgba(252,141,98,1)"},"error_x":{"color":"rgba(252,141,98,1)"},"line":{"color":"rgba(252,141,98,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2023,2024,2025,2026,2027,2028,2029,2030],"y":[32.229368902913002,31.4799084785217,31.336383581478302,31.7618630885435,31.4939924305435,31.583777839217401,31.101776937434799,30.525529074021701,30.831959880826101,30.185517348717401,30.177064768413,30.004931765739101,29.9842098797609,29.439700045326099,29.256267721239102,29.194323134326101,29.084614308587,29.754129567847801,29.779059950847799,29.363458791891301,29.1645244350652,29.247930980456498,29.105957746053502,28.963984511650601,28.822011277247601,28.6800380428446,28.5380648084417,28.396091574038699,28.254118339635699,28.112145105232798,27.970171870829802],"mode":"lines+markers","hoverinfo":["text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text"],"text":["Year:  2000 <br> WaterStress :  32.23","Year:  2001 <br> WaterStress :  31.48","Year:  2002 <br> WaterStress :  31.34","Year:  2003 <br> WaterStress :  31.76","Year:  2004 <br> WaterStress :  31.49","Year:  2005 <br> WaterStress :  31.58","Year:  2006 <br> WaterStress :  31.1","Year:  2007 <br> WaterStress :  30.53","Year:  2008 <br> WaterStress :  30.83","Year:  2009 <br> WaterStress :  30.19","Year:  2010 <br> WaterStress :  30.18","Year:  2011 <br> WaterStress :  30","Year:  2012 <br> WaterStress :  29.98","Year:  2013 <br> WaterStress :  29.44","Year:  2014 <br> WaterStress :  29.26","Year:  2015 <br> WaterStress :  29.19","Year:  2016 <br> WaterStress :  29.08","Year:  2017 <br> WaterStress :  29.75","Year:  2018 <br> WaterStress :  29.78","Year:  2019 <br> WaterStress :  29.36","Year:  2020 <br> WaterStress :  29.16","Year:  2021 <br> WaterStress :  29.25","Year:  2022 <br> WaterStress :  29.11","Year:  2023 <br> WaterStress :  28.96","Year:  2024 <br> WaterStress :  28.82","Year:  2025 <br> WaterStress :  28.68","Year:  2026 <br> WaterStress :  28.54","Year:  2027 <br> WaterStress :  28.4","Year:  2028 <br> WaterStress :  28.25","Year:  2029 <br> WaterStress :  28.11","Year:  2030 <br> WaterStress :  27.97"],"type":"scatter","name":"European Region","marker":{"color":"rgba(141,160,203,1)","line":{"color":"rgba(141,160,203,1)"}},"textfont":{"color":"rgba(141,160,203,1)"},"error_y":{"color":"rgba(141,160,203,1)"},"error_x":{"color":"rgba(141,160,203,1)"},"line":{"color":"rgba(141,160,203,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2023,2024,2025,2026,2027,2028,2029,2030],"y":[13.0880109911111,13.2760507239259,13.493518762111099,13.6932752554444,13.874946684963,13.4965280146296,13.6157410315185,13.716820910999999,13.914907002481501,13.9984292306667,14.1163309485556,14.1588945326667,14.2413965757037,14.266075098185199,14.3128637609259,14.069831280555601,14.275480712666701,14.284231884407401,14.641158272814801,14.648919072074101,14.6182450812222,14.679093849888901,14.7548597003077,14.8306255507265,14.906391401145299,14.9821572515641,15.057923101982899,15.1336889524017,15.209454802820501,15.2852206532392,15.360986503657999],"mode":"lines+markers","hoverinfo":["text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text"],"text":["Year:  2000 <br> WaterStress :  13.09","Year:  2001 <br> WaterStress :  13.28","Year:  2002 <br> WaterStress :  13.49","Year:  2003 <br> WaterStress :  13.69","Year:  2004 <br> WaterStress :  13.87","Year:  2005 <br> WaterStress :  13.5","Year:  2006 <br> WaterStress :  13.62","Year:  2007 <br> WaterStress :  13.72","Year:  2008 <br> WaterStress :  13.91","Year:  2009 <br> WaterStress :  14","Year:  2010 <br> WaterStress :  14.12","Year:  2011 <br> WaterStress :  14.16","Year:  2012 <br> WaterStress :  14.24","Year:  2013 <br> WaterStress :  14.27","Year:  2014 <br> WaterStress :  14.31","Year:  2015 <br> WaterStress :  14.07","Year:  2016 <br> WaterStress :  14.28","Year:  2017 <br> WaterStress :  14.28","Year:  2018 <br> WaterStress :  14.64","Year:  2019 <br> WaterStress :  14.65","Year:  2020 <br> WaterStress :  14.62","Year:  2021 <br> WaterStress :  14.68","Year:  2022 <br> WaterStress :  14.75","Year:  2023 <br> WaterStress :  14.83","Year:  2024 <br> WaterStress :  14.91","Year:  2025 <br> WaterStress :  14.98","Year:  2026 <br> WaterStress :  15.06","Year:  2027 <br> WaterStress :  15.13","Year:  2028 <br> WaterStress :  15.21","Year:  2029 <br> WaterStress :  15.29","Year:  2030 <br> WaterStress :  15.36"],"type":"scatter","name":"Region of the Americas","marker":{"color":"rgba(231,138,195,1)","line":{"color":"rgba(231,138,195,1)"}},"textfont":{"color":"rgba(231,138,195,1)"},"error_y":{"color":"rgba(231,138,195,1)"},"error_x":{"color":"rgba(231,138,195,1)"},"line":{"color":"rgba(231,138,195,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2023,2024,2025,2026,2027,2028,2029,2030],"y":[32.611372979714297,32.879948974571398,33.1961440167143,33.512339058714304,33.1625164378571,33.052853322714299,33.294217887000002,33.562793335571399,33.776947015571402,33.084071216142902,32.391195417142903,34.276545986999999,34.406794514142902,34.537043042714302,34.667291569857099,34.797540098428598,34.927788625571402,34.927788625571402,34.927788625571402,34.927788625571402,34.927788625571402,34.927788625571402,34.927788625571402,34.927788625571402,34.927788625571402,34.927788625571402,34.927788625571402,34.927788625571402,34.927788625571402,34.927788625571402,34.927788625571402],"mode":"lines+markers","hoverinfo":["text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text"],"text":["Year:  2000 <br> WaterStress :  32.61","Year:  2001 <br> WaterStress :  32.88","Year:  2002 <br> WaterStress :  33.2","Year:  2003 <br> WaterStress :  33.51","Year:  2004 <br> WaterStress :  33.16","Year:  2005 <br> WaterStress :  33.05","Year:  2006 <br> WaterStress :  33.29","Year:  2007 <br> WaterStress :  33.56","Year:  2008 <br> WaterStress :  33.78","Year:  2009 <br> WaterStress :  33.08","Year:  2010 <br> WaterStress :  32.39","Year:  2011 <br> WaterStress :  34.28","Year:  2012 <br> WaterStress :  34.41","Year:  2013 <br> WaterStress :  34.54","Year:  2014 <br> WaterStress :  34.67","Year:  2015 <br> WaterStress :  34.8","Year:  2016 <br> WaterStress :  34.93","Year:  2017 <br> WaterStress :  34.93","Year:  2018 <br> WaterStress :  34.93","Year:  2019 <br> WaterStress :  34.93","Year:  2020 <br> WaterStress :  34.93","Year:  2021 <br> WaterStress :  34.93","Year:  2022 <br> WaterStress :  34.93","Year:  2023 <br> WaterStress :  34.93","Year:  2024 <br> WaterStress :  34.93","Year:  2025 <br> WaterStress :  34.93","Year:  2026 <br> WaterStress :  34.93","Year:  2027 <br> WaterStress :  34.93","Year:  2028 <br> WaterStress :  34.93","Year:  2029 <br> WaterStress :  34.93","Year:  2030 <br> WaterStress :  34.93"],"type":"scatter","name":"South-East Asia Region","marker":{"color":"rgba(166,216,84,1)","line":{"color":"rgba(166,216,84,1)"}},"textfont":{"color":"rgba(166,216,84,1)"},"error_y":{"color":"rgba(166,216,84,1)"},"error_x":{"color":"rgba(166,216,84,1)"},"line":{"color":"rgba(166,216,84,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2023,2024,2025,2026,2027,2028,2029,2030],"y":[42.848067229000002,44.173009724166697,45.117575586999997,46.33641809225,47.558490427666698,48.472045793749999,45.938320342416702,43.2967006075,40.7314649941667,38.025514632583302,35.3156384045,32.737667591083301,30.609544306749999,28.503647499749999,26.490282667833299,24.158272087083301,24.337270454666701,24.183367956416699,24.011874622083301,24.047077885083301,23.858175801833301,23.95099177825,24.028013772834701,24.091929360202698,24.144968785247698,24.1889827844137,24.2255071645505,24.255816392742801,24.280968067053902,24.3018398199285,24.319159941947799],"mode":"lines+markers","hoverinfo":["text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text"],"text":["Year:  2000 <br> WaterStress :  42.85","Year:  2001 <br> WaterStress :  44.17","Year:  2002 <br> WaterStress :  45.12","Year:  2003 <br> WaterStress :  46.34","Year:  2004 <br> WaterStress :  47.56","Year:  2005 <br> WaterStress :  48.47","Year:  2006 <br> WaterStress :  45.94","Year:  2007 <br> WaterStress :  43.3","Year:  2008 <br> WaterStress :  40.73","Year:  2009 <br> WaterStress :  38.03","Year:  2010 <br> WaterStress :  35.32","Year:  2011 <br> WaterStress :  32.74","Year:  2012 <br> WaterStress :  30.61","Year:  2013 <br> WaterStress :  28.5","Year:  2014 <br> WaterStress :  26.49","Year:  2015 <br> WaterStress :  24.16","Year:  2016 <br> WaterStress :  24.34","Year:  2017 <br> WaterStress :  24.18","Year:  2018 <br> WaterStress :  24.01","Year:  2019 <br> WaterStress :  24.05","Year:  2020 <br> WaterStress :  23.86","Year:  2021 <br> WaterStress :  23.95","Year:  2022 <br> WaterStress :  24.03","Year:  2023 <br> WaterStress :  24.09","Year:  2024 <br> WaterStress :  24.14","Year:  2025 <br> WaterStress :  24.19","Year:  2026 <br> WaterStress :  24.23","Year:  2027 <br> WaterStress :  24.26","Year:  2028 <br> WaterStress :  24.28","Year:  2029 <br> WaterStress :  24.3","Year:  2030 <br> WaterStress :  24.32"],"type":"scatter","name":"Western Pacific Region","marker":{"color":"rgba(255,217,47,1)","line":{"color":"rgba(255,217,47,1)"}},"textfont":{"color":"rgba(255,217,47,1)"},"error_y":{"color":"rgba(255,217,47,1)"},"error_x":{"color":"rgba(255,217,47,1)"},"line":{"color":"rgba(255,217,47,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>